import { Directive, Input, Output, HostListener, Inject, EventEmitter, ElementRef, ChangeDetectorRef } from '@angular/core';
import { DOCUMENT } from '@angular/common';
import { Meta } from '@angular/platform-browser';
import { Platform } from '@angular/cdk/platform';
import { Clipboard } from '@angular/cdk/clipboard';
import { EMPTY, Observable, Subject } from 'rxjs';
import { takeUntil, tap } from 'rxjs/operators';
import { ShareService } from './share.service';
import { SharerMethod } from './share.models';
import { getValidUrl } from './utils';
import * as ɵngcc0 from '@angular/core';
import * as ɵngcc1 from '@angular/platform-browser';
import * as ɵngcc2 from '@angular/cdk/platform';
import * as ɵngcc3 from '@angular/cdk/clipboard';
export class ShareDirective {
    constructor(_el, _meta, _platform, _clipboard, _share, _cd, _document) {
        this._meta = _meta;
        this._platform = _platform;
        this._clipboard = _clipboard;
        this._share = _share;
        this._cd = _cd;
        this._document = _document;
        /** Stream that emits when button is destroyed */
        this._destroyed = new Subject();
        /** Stream that emit when share button need to be updated */
        this._updater = new Subject();
        /** Set meta tags from document head, useful when SEO is supported */
        this.autoSetMeta = this._share.config.autoSetMeta;
        /** Sharing link */
        this.url = this._share.config.url;
        /** Sets the title parameter */
        this.title = this._share.config.title;
        /** Sets the description parameter */
        this.description = this._share.config.description;
        /** Sets the image parameter for sharing on Pinterest */
        this.image = this._share.config.image;
        /** Sets the tags parameter for sharing on Twitter and Tumblr */
        this.tags = this._share.config.tags;
        /** Stream that emits when share dialog is opened */
        this.opened = new EventEmitter();
        /** Stream that emits when share dialog is closed */
        this.closed = new EventEmitter();
        this._el = _el.nativeElement;
    }
    /**
     * Share the link
     */
    share() {
        // Avoid SSR error
        if (this._platform.isBrowser && this.shareButton) {
            // Prepare sharer url params
            const params = this.autoSetMeta ? this.getParamsFromMetaTags() : this.getParamsFromInputs();
            // Prepare share button click
            const click = this.shareButton.share ? this.open(params) : this.shareButton.func({
                params,
                data: this.shareButton.data,
                clipboard: this._clipboard,
                updater: this._updater
            });
            click.pipe(takeUntil(this._destroyed)).subscribe();
        }
        else {
            console.warn(`${this.text} button is not compatible on this Platform`);
        }
    }
    ngOnInit() {
        // This stream is mainly used to update the copy button text and icon when it is being clicked
        this._updater.pipe(tap((data) => {
            this.icon = data.icon;
            this.text = data.text;
            this._el.style.pointerEvents = data.disabled ? 'none' : 'auto';
            this._cd.markForCheck();
        }), takeUntil(this._destroyed)).subscribe();
    }
    ngOnChanges(changes) {
        // Avoid SSR error
        if (this._platform.isBrowser) {
            // Create share button
            if (this._shareButtonChanged(changes.shareButtonName)) {
                this._createShareButton();
            }
            // Prepare share url
            if (this._urlChanged(changes.url)) {
                this.url = getValidUrl(this.autoSetMeta
                    ? this.url || this._getMetaTagContent('og:url')
                    : this.url, this._document.defaultView.location.href);
            }
        }
    }
    ngOnDestroy() {
        this._destroyed.next();
        this._destroyed.complete();
    }
    _createShareButton() {
        const button = this._share.config.prop[this.shareButtonName];
        if (button) {
            // Set share button properties
            this.shareButton = button;
            // Remove previous button class
            this._el.classList.remove(`sb-${this._buttonClass}`);
            // Add new button class
            this._el.classList.add(`sb-${this.shareButtonName}`);
            // Set button css color variable
            this._el.style.setProperty('--button-color', this.shareButton.color);
            // Keep a copy of the class for future replacement
            this._buttonClass = this.shareButtonName;
            this.color = this.shareButton.color;
            this.text = this.shareButton.text;
            this.icon = this.shareButton.icon;
            // Set aria-label attribute
            this._el.setAttribute('aria-label', button.ariaLabel);
        }
        else {
            console.error(`[ShareButtons]: The share button '${this.shareButtonName}' does not exist!`);
        }
    }
    /**
     * Get meta tag content
     */
    _getMetaTagContent(key) {
        const metaUsingProperty = this._meta.getTag(`property="${key}"`);
        if (metaUsingProperty) {
            return metaUsingProperty.getAttribute('content');
        }
        const metaUsingName = this._meta.getTag(`name="${key}"`);
        if (metaUsingName) {
            return metaUsingName.getAttribute('content');
        }
    }
    _shareButtonChanged(change) {
        return change && (change.firstChange || change.previousValue !== change.currentValue);
    }
    _urlChanged(change) {
        return !this.url || (change && change.previousValue !== change.currentValue);
    }
    /**
     * Get share params from meta tags first and fallback to user inputs
     */
    getParamsFromMetaTags() {
        return {
            url: this.url,
            title: this.title || this._getMetaTagContent('og:title'),
            description: this.description || this._getMetaTagContent('og:description'),
            image: this.image || this._getMetaTagContent('og:image'),
            via: this._share.config.twitterAccount,
            tags: this.tags
        };
    }
    /**
     * Get share params from user inputs
     */
    getParamsFromInputs() {
        return {
            url: this.url,
            title: this.title,
            description: this.description,
            image: this.image,
            tags: this.tags,
            via: this._share.config.twitterAccount,
        };
    }
    open(params) {
        // Set sharer link based on user's device
        let sharerLink;
        if (this._platform.IOS && this.shareButton.share.ios) {
            sharerLink = this.shareButton.share.ios;
        }
        else if (this._platform.ANDROID && this.shareButton.share.android) {
            sharerLink = this.shareButton.share.android;
        }
        else {
            sharerLink = this.shareButton.share.desktop;
        }
        if (sharerLink) {
            // Set sharer link params
            this._finalUrl = sharerLink + this._serializeParams(params);
            // Log the sharer link in debug mode
            if (this._share.config.debug) {
                console.log('[DEBUG SHARE BUTTON]: ', this._finalUrl);
            }
            // Open the share window
            // There are two methods available for opening the share window:
            // 1. Using a real anchor
            // 2. Using window.open
            const sharerMethod = this.shareButton.method || this._share.config.sharerMethod;
            const sharerTarget = this.shareButton.target || this._share.config.sharerTarget;
            switch (sharerMethod) {
                case SharerMethod.Anchor:
                    const linkElement = this._document.createElement('a');
                    // Make it open in a new tab/window (depends on user's browser configuration)
                    linkElement.setAttribute('target', sharerTarget);
                    // Prevent security vulnerability https://medium.com/@jitbit/target-blank-the-most-underestimated-vulnerability-ever-96e328301f4c
                    linkElement.setAttribute('rel', 'noopener noreferrer');
                    linkElement.href = this._finalUrl;
                    linkElement.click();
                    linkElement.remove();
                    break;
                case SharerMethod.Window:
                    // Open link using Window object
                    const openWindow = this._share.config.windowObj[this._share.config.windowFuncName];
                    const popUpWindow = openWindow(this._finalUrl, sharerTarget, this._share.windowSize);
                    // Prevent security vulnerability https://medium.com/@jitbit/target-blank-the-most-underestimated-vulnerability-ever-96e328301f4c
                    this._share.config.windowObj.opener = null;
                    // Resolve when share dialog is closed
                    if (popUpWindow) {
                        return new Observable((sub) => {
                            const pollTimer = this._document.defaultView.setInterval(() => {
                                if (popUpWindow.closed) {
                                    this._document.defaultView.clearInterval(pollTimer);
                                    // Emit when share windows is closed
                                    this.closed.emit(this.shareButtonName);
                                    sub.next();
                                    sub.complete();
                                }
                            }, 200);
                        });
                    }
                    break;
            }
            // Emit when share window is opened
            this.opened.emit(this.shareButtonName);
        }
        return EMPTY;
    }
    _serializeParams(params) {
        return Object.entries(this.shareButton.params)
            .map(([key, value]) => {
            // Check if share button param has a map function
            const paramFunc = this.shareButton.paramsFunc ? this.shareButton.paramsFunc[key] : null;
            if (params[key] || paramFunc) {
                const paramValue = paramFunc ? paramFunc(params) : params[key];
                return `${value}=${encodeURIComponent(paramValue)}`;
            }
            return '';
        })
            .filter(urlParam => urlParam !== '')
            .join('&');
    }
}
ShareDirective.ɵfac = function ShareDirective_Factory(t) { return new (t || ShareDirective)(ɵngcc0.ɵɵdirectiveInject(ɵngcc0.ElementRef), ɵngcc0.ɵɵdirectiveInject(ɵngcc1.Meta), ɵngcc0.ɵɵdirectiveInject(ɵngcc2.Platform), ɵngcc0.ɵɵdirectiveInject(ɵngcc3.Clipboard), ɵngcc0.ɵɵdirectiveInject(ShareService), ɵngcc0.ɵɵdirectiveInject(ɵngcc0.ChangeDetectorRef), ɵngcc0.ɵɵdirectiveInject(DOCUMENT)); };
ShareDirective.ɵdir = ɵngcc0.ɵɵdefineDirective({ type: ShareDirective, selectors: [["", "shareButton", ""]], hostBindings: function ShareDirective_HostBindings(rf, ctx) { if (rf & 1) {
        ɵngcc0.ɵɵlistener("click", function ShareDirective_click_HostBindingHandler() { return ctx.share(); });
    } }, inputs: { autoSetMeta: "autoSetMeta", url: "url", title: "title", description: "description", image: "image", tags: "tags", shareButtonName: ["shareButton", "shareButtonName"] }, outputs: { opened: "opened", closed: "closed" }, exportAs: ["shareButton"], features: [ɵngcc0.ɵɵNgOnChangesFeature] });
ShareDirective.ctorParameters = () => [
    { type: ElementRef },
    { type: Meta },
    { type: Platform },
    { type: Clipboard },
    { type: ShareService },
    { type: ChangeDetectorRef },
    { type: undefined, decorators: [{ type: Inject, args: [DOCUMENT,] }] }
];
ShareDirective.propDecorators = {
    shareButtonName: [{ type: Input, args: ['shareButton',] }],
    autoSetMeta: [{ type: Input }],
    url: [{ type: Input }],
    title: [{ type: Input }],
    description: [{ type: Input }],
    image: [{ type: Input }],
    tags: [{ type: Input }],
    opened: [{ type: Output }],
    closed: [{ type: Output }],
    share: [{ type: HostListener, args: ['click',] }]
};
/*@__PURE__*/ (function () { ɵngcc0.ɵsetClassMetadata(ShareDirective, [{
        type: Directive,
        args: [{
                selector: '[shareButton]',
                exportAs: 'shareButton'
            }]
    }], function () { return [{ type: ɵngcc0.ElementRef }, { type: ɵngcc1.Meta }, { type: ɵngcc2.Platform }, { type: ɵngcc3.Clipboard }, { type: ShareService }, { type: ɵngcc0.ChangeDetectorRef }, { type: undefined, decorators: [{
                type: Inject,
                args: [DOCUMENT]
            }] }]; }, { autoSetMeta: [{
            type: Input
        }], url: [{
            type: Input
        }], title: [{
            type: Input
        }], description: [{
            type: Input
        }], image: [{
            type: Input
        }], tags: [{
            type: Input
        }], opened: [{
            type: Output
        }], closed: [{
            type: Output
        }], 
    /**
     * Share the link
     */
    share: [{
            type: HostListener,
            args: ['click']
        }], shareButtonName: [{
            type: Input,
            args: ['shareButton']
        }] }); })();

//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2hhcmUtYnV0dG9uLmRpcmVjdGl2ZS5qcyIsInNvdXJjZXMiOlsiLi4vLi4vLi4vcHJvamVjdHMvbmd4LXNoYXJlYnV0dG9ucy9zcmMvbGliL3NoYXJlLWJ1dHRvbi5kaXJlY3RpdmUudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUNMLFNBQVMsRUFDVCxLQUFLLEVBQ0wsTUFBTSxFQUNOLFlBQVksRUFDWixNQUFNLEVBTU4sWUFBWSxFQUNaLFVBQVUsRUFDVixpQkFBaUIsRUFDbEIsTUFBTSxlQUFlLENBQUM7QUFDdkIsT0FBTyxFQUFFLFFBQVEsRUFBRSxNQUFNLGlCQUFpQixDQUFDO0FBQzNDLE9BQU8sRUFBRSxJQUFJLEVBQUUsTUFBTSwyQkFBMkIsQ0FBQztBQUNqRCxPQUFPLEVBQUUsUUFBUSxFQUFFLE1BQU0sdUJBQXVCLENBQUM7QUFDakQsT0FBTyxFQUFFLFNBQVMsRUFBRSxNQUFNLHdCQUF3QixDQUFDO0FBQ25ELE9BQU8sRUFBRSxLQUFLLEVBQUUsVUFBVSxFQUFFLE9BQU8sRUFBYyxNQUFNLE1BQU0sQ0FBQztBQUM5RCxPQUFPLEVBQUUsU0FBUyxFQUFFLEdBQUcsRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBRWhELE9BQU8sRUFBRSxZQUFZLEVBQUUsTUFBTSxpQkFBaUIsQ0FBQztBQUMvQyxPQUFPLEVBQXFFLFlBQVksRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBQ2pILE9BQU8sRUFBRSxXQUFXLEVBQUUsTUFBTSxTQUFTLENBQUM7Ozs7O0FBTXRDLE1BQU0sT0FBTyxjQUFjO0FBQUcsSUF3RDVCLFlBQVksR0FBZSxFQUNQLEtBQVcsRUFDWCxTQUFtQixFQUNuQixVQUFxQixFQUNyQixNQUFvQixFQUNwQixHQUFzQixFQUNKLFNBQWM7QUFDdEQsUUFOc0IsVUFBSyxHQUFMLEtBQUssQ0FBTTtBQUFDLFFBQ1osY0FBUyxHQUFULFNBQVMsQ0FBVTtBQUFDLFFBQ3BCLGVBQVUsR0FBVixVQUFVLENBQVc7QUFBQyxRQUN0QixX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LENBQUMsQ0FBQyxDQUFDLFNBQVMsQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFDO0FBQ3ZFLGdCQUFRLE9BQU8sR0FBSSxLQUFNLElBQUssa0JBQWtCLENBQUMsVUFBVSxDQUFFLEVBQUUsQ0FBQztBQUNoRSxhQUFPO0FBQ1AsWUFBTSxPQUFPLEVBQUUsQ0FBQztBQUNoQixRQUFJLENBQUMsQ0FBQztBQUNOLGFBQUssTUFBTSxDQUFDLFFBQVEsQ0FBQyxFQUFFLENBQUMsUUFBUSxLQUFLLEVBQUUsQ0FBQztBQUN4QyxhQUFLLElBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQztBQUNmLElBQUUsQ0FBQztBQUNIOzBDQTNTQyxTQUFTLFNBQUMsa0JBQ1QsUUFBUSxFQUFFLGVBQWUsa0JBQ3pCLFFBQVEsRUFBRSxhQUFhLGNBQ3hCOzs7bVRBQ0k7QUFBQztBQUF3QyxZQWxCNUMsVUFBVTtBQUNWLFlBR08sSUFBSTtBQUFJLFlBQ1IsUUFBUTtBQUFJLFlBQ1osU0FBUztBQUFJLFlBSWIsWUFBWTtBQUFJLFlBVHZCLGlCQUFpQjtBQUNoQiw0Q0E4RVksTUFBTSxTQUFDLFFBQVE7QUFBUTtBQUFHO0FBQ3hCLDhCQWpDZCxLQUFLLFNBQUMsYUFBYTtBQUFPLDBCQUcxQixLQUFLO0FBQUssa0JBR1YsS0FBSztBQUFLLG9CQUdWLEtBQUs7QUFBSywwQkFHVixLQUFLO0FBQUssb0JBR1YsS0FBSztBQUFLLG1CQUdWLEtBQUs7QUFBSyxxQkFHVixNQUFNO0FBQUsscUJBR1gsTUFBTTtBQUFLLG9CQWVYLFlBQVksU0FBQyxPQUFPO0FBQ25COzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7b0JBQUU7QUFBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7XG4gIERpcmVjdGl2ZSxcbiAgSW5wdXQsXG4gIE91dHB1dCxcbiAgSG9zdExpc3RlbmVyLFxuICBJbmplY3QsXG4gIE9uSW5pdCxcbiAgT25DaGFuZ2VzLFxuICBPbkRlc3Ryb3ksXG4gIFNpbXBsZUNoYW5nZXMsXG4gIFNpbXBsZUNoYW5nZSxcbiAgRXZlbnRFbWl0dGVyLFxuICBFbGVtZW50UmVmLFxuICBDaGFuZ2VEZXRlY3RvclJlZlxufSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IERPQ1VNRU5UIH0gZnJvbSAnQGFuZ3VsYXIvY29tbW9uJztcbmltcG9ydCB7IE1ldGEgfSBmcm9tICdAYW5ndWxhci9wbGF0Zm9ybS1icm93c2VyJztcbmltcG9ydCB7IFBsYXRmb3JtIH0gZnJvbSAnQGFuZ3VsYXIvY2RrL3BsYXRmb3JtJztcbmltcG9ydCB7IENsaXBib2FyZCB9IGZyb20gJ0Bhbmd1bGFyL2Nkay9jbGlwYm9hcmQnO1xuaW1wb3J0IHsgRU1QVFksIE9ic2VydmFibGUsIFN1YmplY3QsIFN1YnNjcmliZXIgfSBmcm9tICdyeGpzJztcbmltcG9ydCB7IHRha2VVbnRpbCwgdGFwIH0gZnJvbSAncnhqcy9vcGVyYXRvcnMnO1xuXG5pbXBvcnQgeyBTaGFyZVNlcnZpY2UgfSBmcm9tICcuL3NoYXJlLnNlcnZpY2UnO1xuaW1wb3J0IHsgSVNoYXJlQnV0dG9uLCBTaGFyZURpcmVjdGl2ZVVwZGF0ZXIsIFNoYXJlUGFyYW1zLCBTaGFyZVBhcmFtc0Z1bmMsIFNoYXJlck1ldGhvZCB9IGZyb20gJy4vc2hhcmUubW9kZWxzJztcbmltcG9ydCB7IGdldFZhbGlkVXJsIH0gZnJvbSAnLi91dGlscyc7XG5cbkBEaXJlY3RpdmUoe1xuICBzZWxlY3RvcjogJ1tzaGFyZUJ1dHRvbl0nLFxuICBleHBvcnRBczogJ3NoYXJlQnV0dG9uJ1xufSlcbmV4cG9ydCBjbGFzcyBTaGFyZURpcmVjdGl2ZSBpbXBsZW1lbnRzIE9uSW5pdCwgT25DaGFuZ2VzLCBPbkRlc3Ryb3kge1xuXG4gIC8qKiBWYXJpYWJsZSB1c2VkIHRvIGNoZWNrIGZvciB0aGUgZmluYWwgc2hhcmVyIHVybCAoRm9yIHRlc3Rpbmcgb25seSkgKi9cbiAgcHJpdmF0ZSBfZmluYWxVcmw6IHN0cmluZztcblxuICAvKiogU2hhcmUgZGlyZWN0aXZlIGVsZW1lbnQgcmVmICovXG4gIHByaXZhdGUgcmVhZG9ubHkgX2VsOiBIVE1MQnV0dG9uRWxlbWVudDtcblxuICAvKiogQSByZWYgdG8gYnV0dG9uIGNsYXNzIC0gdXNlZCB0byByZW1vdmUgcHJldmlvdXMgY2xhc3Mgd2hlbiB0aGUgYnV0dG9uIHR5cGUgaXMgY2hhbmdlZCAqL1xuICBwcml2YXRlIF9idXR0b25DbGFzczogc3RyaW5nO1xuXG4gIC8qKiBTdHJlYW0gdGhhdCBlbWl0cyB3aGVuIGJ1dHRvbiBpcyBkZXN0cm95ZWQgKi9cbiAgcHJpdmF0ZSByZWFkb25seSBfZGVzdHJveWVkID0gbmV3IFN1YmplY3Q8dm9pZD4oKTtcblxuICAvKiogU3RyZWFtIHRoYXQgZW1pdCB3aGVuIHNoYXJlIGJ1dHRvbiBuZWVkIHRvIGJlIHVwZGF0ZWQgKi9cbiAgcHJpdmF0ZSByZWFkb25seSBfdXBkYXRlciA9IG5ldyBTdWJqZWN0PFNoYXJlRGlyZWN0aXZlVXBkYXRlcj4oKTtcblxuICAvKiogU2hhcmUgYnV0dG9uIHByb3BlcnRpZXMgKi9cbiAgc2hhcmVCdXR0b246IElTaGFyZUJ1dHRvbjtcblxuICAvKiogU2hhcmUgYnV0dG9uIGNvbG9yICovXG4gIGNvbG9yOiBzdHJpbmc7XG5cbiAgLyoqIFNoYXJlIGJ1dHRvbiB0ZXh0ICovXG4gIHRleHQ6IHN0cmluZztcblxuICAvKiogU2hhcmUgYnV0dG9uIGljb24gKi9cbiAgaWNvbjogc3RyaW5nIHwgc3RyaW5nW107XG5cbiAgLyoqIFNoYXJlIGJ1dHRvbiB0eXBlICovXG4gIEBJbnB1dCgnc2hhcmVCdXR0b24nKSBzaGFyZUJ1dHRvbk5hbWU6IHN0cmluZztcblxuICAvKiogU2V0IG1ldGEgdGFncyBmcm9tIGRvY3VtZW50IGhlYWQsIHVzZWZ1bCB3aGVuIFNFTyBpcyBzdXBwb3J0ZWQgKi9cbiAgQElucHV0KCkgYXV0b1NldE1ldGE6IGJvb2xlYW4gPSB0aGlzLl9zaGFyZS5jb25maWcuYXV0b1NldE1ldGE7XG5cbiAgLyoqIFNoYXJpbmcgbGluayAqL1xuICBASW5wdXQoKSB1cmw6IHN0cmluZyA9IHRoaXMuX3NoYXJlLmNvbmZpZy51cmw7XG5cbiAgLyoqIFNldHMgdGhlIHRpdGxlIHBhcmFtZXRlciAqL1xuICBASW5wdXQoKSB0aXRsZTogc3RyaW5nID0gdGhpcy5fc2hhcmUuY29uZmlnLnRpdGxlO1xuXG4gIC8qKiBTZXRzIHRoZSBkZXNjcmlwdGlvbiBwYXJhbWV0ZXIgKi9cbiAgQElucHV0KCkgZGVzY3JpcHRpb246IHN0cmluZyA9IHRoaXMuX3NoYXJlLmNvbmZpZy5kZXNjcmlwdGlvbjtcblxuICAvKiogU2V0cyB0aGUgaW1hZ2UgcGFyYW1ldGVyIGZvciBzaGFyaW5nIG9uIFBpbnRlcmVzdCAqL1xuICBASW5wdXQoKSBpbWFnZTogc3RyaW5nID0gdGhpcy5fc2hhcmUuY29uZmlnLmltYWdlO1xuXG4gIC8qKiBTZXRzIHRoZSB0YWdzIHBhcmFtZXRlciBmb3Igc2hhcmluZyBvbiBUd2l0dGVyIGFuZCBUdW1ibHIgKi9cbiAgQElucHV0KCkgdGFnczogc3RyaW5nID0gdGhpcy5fc2hhcmUuY29uZmlnLnRhZ3M7XG5cbiAgLyoqIFN0cmVhbSB0aGF0IGVtaXRzIHdoZW4gc2hhcmUgZGlhbG9nIGlzIG9wZW5lZCAqL1xuICBAT3V0cHV0KCkgb3BlbmVkID0gbmV3IEV2ZW50RW1pdHRlcjxzdHJpbmc+KCk7XG5cbiAgLyoqIFN0cmVhbSB0aGF0IGVtaXRzIHdoZW4gc2hhcmUgZGlhbG9nIGlzIGNsb3NlZCAqL1xuICBAT3V0cHV0KCkgY2xvc2VkID0gbmV3IEV2ZW50RW1pdHRlcjxzdHJpbmc+KCk7XG5cbiAgY29uc3RydWN0b3IoX2VsOiBFbGVtZW50UmVmLFxuICAgICAgICAgICAgICBwcml2YXRlIF9tZXRhOiBNZXRhLFxuICAgICAgICAgICAgICBwcml2YXRlIF9wbGF0Zm9ybTogUGxhdGZvcm0sXG4gICAgICAgICAgICAgIHByaXZhdGUgX2NsaXBib2FyZDogQ2xpcGJvYXJkLFxuICAgICAgICAgICAgICBwcml2YXRlIF9zaGFyZTogU2hhcmVTZXJ2aWNlLFxuICAgICAgICAgICAgICBwcml2YXRlIF9jZDogQ2hhbmdlRGV0ZWN0b3JSZWYsXG4gICAgICAgICAgICAgIEBJbmplY3QoRE9DVU1FTlQpIHByaXZhdGUgX2RvY3VtZW50OiBhbnkpIHtcbiAgICB0aGlzLl9lbCA9IF9lbC5uYXRpdmVFbGVtZW50O1xuICB9XG5cbiAgLyoqXG4gICAqIFNoYXJlIHRoZSBsaW5rXG4gICAqL1xuICBASG9zdExpc3RlbmVyKCdjbGljaycpXG4gIHNoYXJlKCkge1xuICAgIC8vIEF2b2lkIFNTUiBlcnJvclxuICAgIGlmICh0aGlzLl9wbGF0Zm9ybS5pc0Jyb3dzZXIgJiYgdGhpcy5zaGFyZUJ1dHRvbikge1xuICAgICAgLy8gUHJlcGFyZSBzaGFyZXIgdXJsIHBhcmFtc1xuICAgICAgY29uc3QgcGFyYW1zOiBTaGFyZVBhcmFtcyA9IHRoaXMuYXV0b1NldE1ldGEgPyB0aGlzLmdldFBhcmFtc0Zyb21NZXRhVGFncygpIDogdGhpcy5nZXRQYXJhbXNGcm9tSW5wdXRzKCk7XG5cbiAgICAgIC8vIFByZXBhcmUgc2hhcmUgYnV0dG9uIGNsaWNrXG4gICAgICBjb25zdCBjbGljayA9IHRoaXMuc2hhcmVCdXR0b24uc2hhcmUgPyB0aGlzLm9wZW4ocGFyYW1zKSA6IHRoaXMuc2hhcmVCdXR0b24uZnVuYyh7XG4gICAgICAgIHBhcmFtcyxcbiAgICAgICAgZGF0YTogdGhpcy5zaGFyZUJ1dHRvbi5kYXRhLFxuICAgICAgICBjbGlwYm9hcmQ6IHRoaXMuX2NsaXBib2FyZCxcbiAgICAgICAgdXBkYXRlcjogdGhpcy5fdXBkYXRlclxuICAgICAgfSk7XG5cbiAgICAgIGNsaWNrLnBpcGUodGFrZVVudGlsKHRoaXMuX2Rlc3Ryb3llZCkpLnN1YnNjcmliZSgpO1xuICAgIH0gZWxzZSB7XG4gICAgICBjb25zb2xlLndhcm4oYCR7IHRoaXMudGV4dCB9IGJ1dHRvbiBpcyBub3QgY29tcGF0aWJsZSBvbiB0aGlzIFBsYXRmb3JtYCk7XG4gICAgfVxuICB9XG5cbiAgbmdPbkluaXQoKSB7XG4gICAgLy8gVGhpcyBzdHJlYW0gaXMgbWFpbmx5IHVzZWQgdG8gdXBkYXRlIHRoZSBjb3B5IGJ1dHRvbiB0ZXh0IGFuZCBpY29uIHdoZW4gaXQgaXMgYmVpbmcgY2xpY2tlZFxuICAgIHRoaXMuX3VwZGF0ZXIucGlwZShcbiAgICAgIHRhcCgoZGF0YTogYW55KSA9PiB7XG4gICAgICAgIHRoaXMuaWNvbiA9IGRhdGEuaWNvbjtcbiAgICAgICAgdGhpcy50ZXh0ID0gZGF0YS50ZXh0O1xuICAgICAgICB0aGlzLl9lbC5zdHlsZS5wb2ludGVyRXZlbnRzID0gZGF0YS5kaXNhYmxlZCA/ICdub25lJyA6ICdhdXRvJztcbiAgICAgICAgdGhpcy5fY2QubWFya0ZvckNoZWNrKCk7XG4gICAgICB9KSxcbiAgICAgIHRha2VVbnRpbCh0aGlzLl9kZXN0cm95ZWQpXG4gICAgKS5zdWJzY3JpYmUoKTtcbiAgfVxuXG4gIG5nT25DaGFuZ2VzKGNoYW5nZXM6IFNpbXBsZUNoYW5nZXMpIHtcbiAgICAvLyBBdm9pZCBTU1IgZXJyb3JcbiAgICBpZiAodGhpcy5fcGxhdGZvcm0uaXNCcm93c2VyKSB7XG5cbiAgICAgIC8vIENyZWF0ZSBzaGFyZSBidXR0b25cbiAgICAgIGlmICh0aGlzLl9zaGFyZUJ1dHRvbkNoYW5nZWQoY2hhbmdlcy5zaGFyZUJ1dHRvbk5hbWUpKSB7XG4gICAgICAgIHRoaXMuX2NyZWF0ZVNoYXJlQnV0dG9uKCk7XG4gICAgICB9XG4gICAgICAvLyBQcmVwYXJlIHNoYXJlIHVybFxuICAgICAgaWYgKHRoaXMuX3VybENoYW5nZWQoY2hhbmdlcy51cmwpKSB7XG4gICAgICAgIHRoaXMudXJsID0gZ2V0VmFsaWRVcmwoXG4gICAgICAgICAgdGhpcy5hdXRvU2V0TWV0YVxuICAgICAgICAgICAgPyB0aGlzLnVybCB8fCB0aGlzLl9nZXRNZXRhVGFnQ29udGVudCgnb2c6dXJsJylcbiAgICAgICAgICAgIDogdGhpcy51cmwsXG4gICAgICAgICAgdGhpcy5fZG9jdW1lbnQuZGVmYXVsdFZpZXcubG9jYXRpb24uaHJlZlxuICAgICAgICApO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIG5nT25EZXN0cm95KCkge1xuICAgIHRoaXMuX2Rlc3Ryb3llZC5uZXh0KCk7XG4gICAgdGhpcy5fZGVzdHJveWVkLmNvbXBsZXRlKCk7XG4gIH1cblxuICBwcml2YXRlIF9jcmVhdGVTaGFyZUJ1dHRvbigpIHtcbiAgICBjb25zdCBidXR0b246IElTaGFyZUJ1dHRvbiA9IHRoaXMuX3NoYXJlLmNvbmZpZy5wcm9wW3RoaXMuc2hhcmVCdXR0b25OYW1lXTtcbiAgICBpZiAoYnV0dG9uKSB7XG4gICAgICAvLyBTZXQgc2hhcmUgYnV0dG9uIHByb3BlcnRpZXNcbiAgICAgIHRoaXMuc2hhcmVCdXR0b24gPSBidXR0b247XG5cbiAgICAgIC8vIFJlbW92ZSBwcmV2aW91cyBidXR0b24gY2xhc3NcbiAgICAgIHRoaXMuX2VsLmNsYXNzTGlzdC5yZW1vdmUoYHNiLSR7IHRoaXMuX2J1dHRvbkNsYXNzIH1gKTtcblxuICAgICAgLy8gQWRkIG5ldyBidXR0b24gY2xhc3NcbiAgICAgIHRoaXMuX2VsLmNsYXNzTGlzdC5hZGQoYHNiLSR7IHRoaXMuc2hhcmVCdXR0b25OYW1lIH1gKTtcblxuICAgICAgLy8gU2V0IGJ1dHRvbiBjc3MgY29sb3IgdmFyaWFibGVcbiAgICAgIHRoaXMuX2VsLnN0eWxlLnNldFByb3BlcnR5KCctLWJ1dHRvbi1jb2xvcicsIHRoaXMuc2hhcmVCdXR0b24uY29sb3IpO1xuXG4gICAgICAvLyBLZWVwIGEgY29weSBvZiB0aGUgY2xhc3MgZm9yIGZ1dHVyZSByZXBsYWNlbWVudFxuICAgICAgdGhpcy5fYnV0dG9uQ2xhc3MgPSB0aGlzLnNoYXJlQnV0dG9uTmFtZTtcblxuICAgICAgdGhpcy5jb2xvciA9IHRoaXMuc2hhcmVCdXR0b24uY29sb3I7XG4gICAgICB0aGlzLnRleHQgPSB0aGlzLnNoYXJlQnV0dG9uLnRleHQ7XG4gICAgICB0aGlzLmljb24gPSB0aGlzLnNoYXJlQnV0dG9uLmljb247XG5cbiAgICAgIC8vIFNldCBhcmlhLWxhYmVsIGF0dHJpYnV0ZVxuICAgICAgdGhpcy5fZWwuc2V0QXR0cmlidXRlKCdhcmlhLWxhYmVsJywgYnV0dG9uLmFyaWFMYWJlbCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoYFtTaGFyZUJ1dHRvbnNdOiBUaGUgc2hhcmUgYnV0dG9uICckeyB0aGlzLnNoYXJlQnV0dG9uTmFtZSB9JyBkb2VzIG5vdCBleGlzdCFgKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogR2V0IG1ldGEgdGFnIGNvbnRlbnRcbiAgICovXG4gIHByaXZhdGUgX2dldE1ldGFUYWdDb250ZW50KGtleTogc3RyaW5nKTogc3RyaW5nIHtcbiAgICBjb25zdCBtZXRhVXNpbmdQcm9wZXJ0eTogSFRNTE1ldGFFbGVtZW50ID0gdGhpcy5fbWV0YS5nZXRUYWcoYHByb3BlcnR5PVwiJHsga2V5IH1cImApO1xuICAgIGlmIChtZXRhVXNpbmdQcm9wZXJ0eSkge1xuICAgICAgcmV0dXJuIG1ldGFVc2luZ1Byb3BlcnR5LmdldEF0dHJpYnV0ZSgnY29udGVudCcpO1xuICAgIH1cbiAgICBjb25zdCBtZXRhVXNpbmdOYW1lOiBIVE1MTWV0YUVsZW1lbnQgPSB0aGlzLl9tZXRhLmdldFRhZyhgbmFtZT1cIiR7IGtleSB9XCJgKTtcbiAgICBpZiAobWV0YVVzaW5nTmFtZSkge1xuICAgICAgcmV0dXJuIG1ldGFVc2luZ05hbWUuZ2V0QXR0cmlidXRlKCdjb250ZW50Jyk7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBfc2hhcmVCdXR0b25DaGFuZ2VkKGNoYW5nZTogU2ltcGxlQ2hhbmdlKTogYm9vbGVhbiB7XG4gICAgcmV0dXJuIGNoYW5nZSAmJiAoY2hhbmdlLmZpcnN0Q2hhbmdlIHx8IGNoYW5nZS5wcmV2aW91c1ZhbHVlICE9PSBjaGFuZ2UuY3VycmVudFZhbHVlKTtcbiAgfVxuXG4gIHByaXZhdGUgX3VybENoYW5nZWQoY2hhbmdlOiBTaW1wbGVDaGFuZ2UpOiBib29sZWFuIHtcbiAgICByZXR1cm4gIXRoaXMudXJsIHx8IChjaGFuZ2UgJiYgY2hhbmdlLnByZXZpb3VzVmFsdWUgIT09IGNoYW5nZS5jdXJyZW50VmFsdWUpO1xuICB9XG5cbiAgLyoqXG4gICAqIEdldCBzaGFyZSBwYXJhbXMgZnJvbSBtZXRhIHRhZ3MgZmlyc3QgYW5kIGZhbGxiYWNrIHRvIHVzZXIgaW5wdXRzXG4gICAqL1xuICBwcml2YXRlIGdldFBhcmFtc0Zyb21NZXRhVGFncygpOiBTaGFyZVBhcmFtcyB7XG4gICAgcmV0dXJuIHtcbiAgICAgIHVybDogdGhpcy51cmwsXG4gICAgICB0aXRsZTogdGhpcy50aXRsZSB8fCB0aGlzLl9nZXRNZXRhVGFnQ29udGVudCgnb2c6dGl0bGUnKSxcbiAgICAgIGRlc2NyaXB0aW9uOiB0aGlzLmRlc2NyaXB0aW9uIHx8IHRoaXMuX2dldE1ldGFUYWdDb250ZW50KCdvZzpkZXNjcmlwdGlvbicpLFxuICAgICAgaW1hZ2U6IHRoaXMuaW1hZ2UgfHwgdGhpcy5fZ2V0TWV0YVRhZ0NvbnRlbnQoJ29nOmltYWdlJyksXG4gICAgICB2aWE6IHRoaXMuX3NoYXJlLmNvbmZpZy50d2l0dGVyQWNjb3VudCxcbiAgICAgIHRhZ3M6IHRoaXMudGFnc1xuICAgIH07XG4gIH1cblxuICAvKipcbiAgICogR2V0IHNoYXJlIHBhcmFtcyBmcm9tIHVzZXIgaW5wdXRzXG4gICAqL1xuICBwcml2YXRlIGdldFBhcmFtc0Zyb21JbnB1dHMoKTogU2hhcmVQYXJhbXMge1xuICAgIHJldHVybiB7XG4gICAgICB1cmw6IHRoaXMudXJsLFxuICAgICAgdGl0bGU6IHRoaXMudGl0bGUsXG4gICAgICBkZXNjcmlwdGlvbjogdGhpcy5kZXNjcmlwdGlvbixcbiAgICAgIGltYWdlOiB0aGlzLmltYWdlLFxuICAgICAgdGFnczogdGhpcy50YWdzLFxuICAgICAgdmlhOiB0aGlzLl9zaGFyZS5jb25maWcudHdpdHRlckFjY291bnQsXG4gICAgfTtcbiAgfVxuXG4gIHByaXZhdGUgb3BlbihwYXJhbXM6IFNoYXJlUGFyYW1zKTogT2JzZXJ2YWJsZTx2b2lkPiB7XG4gICAgLy8gU2V0IHNoYXJlciBsaW5rIGJhc2VkIG9uIHVzZXIncyBkZXZpY2VcbiAgICBsZXQgc2hhcmVyTGluazogc3RyaW5nO1xuICAgIGlmICh0aGlzLl9wbGF0Zm9ybS5JT1MgJiYgdGhpcy5zaGFyZUJ1dHRvbi5zaGFyZS5pb3MpIHtcbiAgICAgIHNoYXJlckxpbmsgPSB0aGlzLnNoYXJlQnV0dG9uLnNoYXJlLmlvcztcbiAgICB9IGVsc2UgaWYgKHRoaXMuX3BsYXRmb3JtLkFORFJPSUQgJiYgdGhpcy5zaGFyZUJ1dHRvbi5zaGFyZS5hbmRyb2lkKSB7XG4gICAgICBzaGFyZXJMaW5rID0gdGhpcy5zaGFyZUJ1dHRvbi5zaGFyZS5hbmRyb2lkO1xuICAgIH0gZWxzZSB7XG4gICAgICBzaGFyZXJMaW5rID0gdGhpcy5zaGFyZUJ1dHRvbi5zaGFyZS5kZXNrdG9wO1xuICAgIH1cblxuICAgIGlmIChzaGFyZXJMaW5rKSB7XG4gICAgICAvLyBTZXQgc2hhcmVyIGxpbmsgcGFyYW1zXG4gICAgICB0aGlzLl9maW5hbFVybCA9IHNoYXJlckxpbmsgKyB0aGlzLl9zZXJpYWxpemVQYXJhbXMocGFyYW1zKTtcblxuICAgICAgLy8gTG9nIHRoZSBzaGFyZXIgbGluayBpbiBkZWJ1ZyBtb2RlXG4gICAgICBpZiAodGhpcy5fc2hhcmUuY29uZmlnLmRlYnVnKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKCdbREVCVUcgU0hBUkUgQlVUVE9OXTogJywgdGhpcy5fZmluYWxVcmwpO1xuICAgICAgfVxuXG4gICAgICAvLyBPcGVuIHRoZSBzaGFyZSB3aW5kb3dcbiAgICAgIC8vIFRoZXJlIGFyZSB0d28gbWV0aG9kcyBhdmFpbGFibGUgZm9yIG9wZW5pbmcgdGhlIHNoYXJlIHdpbmRvdzpcbiAgICAgIC8vIDEuIFVzaW5nIGEgcmVhbCBhbmNob3JcbiAgICAgIC8vIDIuIFVzaW5nIHdpbmRvdy5vcGVuXG4gICAgICBjb25zdCBzaGFyZXJNZXRob2QgPSB0aGlzLnNoYXJlQnV0dG9uLm1ldGhvZCB8fCB0aGlzLl9zaGFyZS5jb25maWcuc2hhcmVyTWV0aG9kO1xuICAgICAgY29uc3Qgc2hhcmVyVGFyZ2V0ID0gdGhpcy5zaGFyZUJ1dHRvbi50YXJnZXQgfHwgdGhpcy5fc2hhcmUuY29uZmlnLnNoYXJlclRhcmdldDtcblxuICAgICAgc3dpdGNoIChzaGFyZXJNZXRob2QpIHtcblxuICAgICAgICBjYXNlIFNoYXJlck1ldGhvZC5BbmNob3I6XG4gICAgICAgICAgY29uc3QgbGlua0VsZW1lbnQ6IEhUTUxMaW5rRWxlbWVudCA9IHRoaXMuX2RvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2EnKTtcbiAgICAgICAgICAvLyBNYWtlIGl0IG9wZW4gaW4gYSBuZXcgdGFiL3dpbmRvdyAoZGVwZW5kcyBvbiB1c2VyJ3MgYnJvd3NlciBjb25maWd1cmF0aW9uKVxuICAgICAgICAgIGxpbmtFbGVtZW50LnNldEF0dHJpYnV0ZSgndGFyZ2V0Jywgc2hhcmVyVGFyZ2V0KTtcblxuICAgICAgICAgIC8vIFByZXZlbnQgc2VjdXJpdHkgdnVsbmVyYWJpbGl0eSBodHRwczovL21lZGl1bS5jb20vQGppdGJpdC90YXJnZXQtYmxhbmstdGhlLW1vc3QtdW5kZXJlc3RpbWF0ZWQtdnVsbmVyYWJpbGl0eS1ldmVyLTk2ZTMyODMwMWY0Y1xuICAgICAgICAgIGxpbmtFbGVtZW50LnNldEF0dHJpYnV0ZSgncmVsJywgJ25vb3BlbmVyIG5vcmVmZXJyZXInKTtcbiAgICAgICAgICBsaW5rRWxlbWVudC5ocmVmID0gdGhpcy5fZmluYWxVcmw7XG4gICAgICAgICAgbGlua0VsZW1lbnQuY2xpY2soKTtcbiAgICAgICAgICBsaW5rRWxlbWVudC5yZW1vdmUoKTtcbiAgICAgICAgICBicmVhaztcblxuICAgICAgICBjYXNlIFNoYXJlck1ldGhvZC5XaW5kb3c6XG4gICAgICAgICAgLy8gT3BlbiBsaW5rIHVzaW5nIFdpbmRvdyBvYmplY3RcbiAgICAgICAgICBjb25zdCBvcGVuV2luZG93ID0gdGhpcy5fc2hhcmUuY29uZmlnLndpbmRvd09ialt0aGlzLl9zaGFyZS5jb25maWcud2luZG93RnVuY05hbWVdO1xuICAgICAgICAgIGNvbnN0IHBvcFVwV2luZG93ID0gb3BlbldpbmRvdyh0aGlzLl9maW5hbFVybCwgc2hhcmVyVGFyZ2V0LCB0aGlzLl9zaGFyZS53aW5kb3dTaXplKTtcblxuICAgICAgICAgIC8vIFByZXZlbnQgc2VjdXJpdHkgdnVsbmVyYWJpbGl0eSBodHRwczovL21lZGl1bS5jb20vQGppdGJpdC90YXJnZXQtYmxhbmstdGhlLW1vc3QtdW5kZXJlc3RpbWF0ZWQtdnVsbmVyYWJpbGl0eS1ldmVyLTk2ZTMyODMwMWY0Y1xuICAgICAgICAgIHRoaXMuX3NoYXJlLmNvbmZpZy53aW5kb3dPYmoub3BlbmVyID0gbnVsbDtcblxuICAgICAgICAgIC8vIFJlc29sdmUgd2hlbiBzaGFyZSBkaWFsb2cgaXMgY2xvc2VkXG4gICAgICAgICAgaWYgKHBvcFVwV2luZG93KSB7XG4gICAgICAgICAgICByZXR1cm4gbmV3IE9ic2VydmFibGU8dm9pZD4oKHN1YjogU3Vic2NyaWJlcjx2b2lkPikgPT4ge1xuICAgICAgICAgICAgICBjb25zdCBwb2xsVGltZXIgPSB0aGlzLl9kb2N1bWVudC5kZWZhdWx0Vmlldy5zZXRJbnRlcnZhbCgoKSA9PiB7XG4gICAgICAgICAgICAgICAgaWYgKHBvcFVwV2luZG93LmNsb3NlZCkge1xuICAgICAgICAgICAgICAgICAgdGhpcy5fZG9jdW1lbnQuZGVmYXVsdFZpZXcuY2xlYXJJbnRlcnZhbChwb2xsVGltZXIpO1xuXG4gICAgICAgICAgICAgICAgICAvLyBFbWl0IHdoZW4gc2hhcmUgd2luZG93cyBpcyBjbG9zZWRcbiAgICAgICAgICAgICAgICAgIHRoaXMuY2xvc2VkLmVtaXQodGhpcy5zaGFyZUJ1dHRvbk5hbWUpO1xuICAgICAgICAgICAgICAgICAgc3ViLm5leHQoKTtcbiAgICAgICAgICAgICAgICAgIHN1Yi5jb21wbGV0ZSgpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgfSwgMjAwKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgIH1cbiAgICAgICAgICBicmVhaztcbiAgICAgIH1cblxuICAgICAgLy8gRW1pdCB3aGVuIHNoYXJlIHdpbmRvdyBpcyBvcGVuZWRcbiAgICAgIHRoaXMub3BlbmVkLmVtaXQodGhpcy5zaGFyZUJ1dHRvbk5hbWUpO1xuICAgIH1cbiAgICByZXR1cm4gRU1QVFk7XG4gIH1cblxuICBwcml2YXRlIF9zZXJpYWxpemVQYXJhbXMocGFyYW1zOiBTaGFyZVBhcmFtcyk6IHN0cmluZyB7XG4gICAgcmV0dXJuIE9iamVjdC5lbnRyaWVzKHRoaXMuc2hhcmVCdXR0b24ucGFyYW1zKVxuICAgIC5tYXAoKFtrZXksIHZhbHVlXSkgPT4ge1xuICAgICAgLy8gQ2hlY2sgaWYgc2hhcmUgYnV0dG9uIHBhcmFtIGhhcyBhIG1hcCBmdW5jdGlvblxuICAgICAgY29uc3QgcGFyYW1GdW5jOiBTaGFyZVBhcmFtc0Z1bmMgPSB0aGlzLnNoYXJlQnV0dG9uLnBhcmFtc0Z1bmMgPyB0aGlzLnNoYXJlQnV0dG9uLnBhcmFtc0Z1bmNba2V5XSA6IG51bGw7XG5cbiAgICAgIGlmIChwYXJhbXNba2V5XSB8fCBwYXJhbUZ1bmMpIHtcbiAgICAgICAgY29uc3QgcGFyYW1WYWx1ZSA9IHBhcmFtRnVuYyA/IHBhcmFtRnVuYyhwYXJhbXMpIDogcGFyYW1zW2tleV07XG4gICAgICAgIHJldHVybiBgJHsgdmFsdWUgfT0keyBlbmNvZGVVUklDb21wb25lbnQocGFyYW1WYWx1ZSkgfWA7XG4gICAgICB9XG4gICAgICByZXR1cm4gJyc7XG4gICAgfSlcbiAgICAuZmlsdGVyKHVybFBhcmFtID0+IHVybFBhcmFtICE9PSAnJylcbiAgICAuam9pbignJicpO1xuICB9XG59XG4iXX0=