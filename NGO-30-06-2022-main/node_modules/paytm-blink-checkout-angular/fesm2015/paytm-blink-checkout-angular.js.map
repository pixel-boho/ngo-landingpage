{"version":3,"file":"paytm-blink-checkout-angular.js.map","sources":["ng://paytm-blink-checkout-angular/lib/constants/index.ts","ng://paytm-blink-checkout-angular/lib/services/window.service.ts","ng://paytm-blink-checkout-angular/lib/models/index.ts","ng://paytm-blink-checkout-angular/lib/services/checkout.service.ts","ng://paytm-blink-checkout-angular/lib/components/checkout.component.ts","ng://paytm-blink-checkout-angular/lib/checkout.module.ts","ng://paytm-blink-checkout-angular/public-api.ts","ng://paytm-blink-checkout-angular/paytm-blink-checkout-angular.ts"],"sourcesContent":["const CONSTANTS = {\n    PROJECT_NAME: 'Paytm Blink Checkout JS',\n    ENV: {\n        PROD: 'PROD',\n        STAGE: 'STAGE'\n    },\n    HOSTS: {\n        PROD: 'https://securegw.paytm.in',\n        STAGE: 'https://securegw-stage.paytm.in'\n    },\n    LINKS: {\n        CHECKOUT_JS_URL: '/merchantpgpui/checkoutjs/merchants/'\n    },\n    ERRORS: {\n        INIT : 'An error during initialization!',\n        INVOKE : 'An error during invoking!',\n        MERCHANT_ID_NOT_FOUND: 'Please provide merchant id!',\n        CHECKOUT_NOT_AVAILABLE: 'Checkout JS library not found. Please make sure you have included checkout js!',\n        INVALID_CHECKOUT_JS_INSTANCE: 'Invalid instance provided!'\n    },\n    IDS: {\n        CHECKOUT_ELEMENT: 'checkout-wrapper-'\n    }\n};\n\n// Prefix error with project name\nObject.keys(CONSTANTS.ERRORS).forEach(errorCode=>{\n    CONSTANTS.ERRORS[errorCode] = `${CONSTANTS.PROJECT_NAME}: ${CONSTANTS.ERRORS[errorCode]}`;\n});\n\nexport default CONSTANTS;\n","import { InjectionToken } from '@angular/core';\nimport { ICheckoutInstance } from '../models';\n\nexport interface Window {\n    Paytm?: {\n        CheckoutJS?: ICheckoutInstance\n    };\n}\n\nexport const WINDOW_TOKEN = new InjectionToken<Window>('Window', {\n    providedIn: 'root',\n    factory: () => window as Window\n});","import CONSTANTS from \"../constants\";\n\ninterface IStringDictionary {\n    [key: string]: string\n}\n\nexport interface ICheckoutInstance {\n    onLoad?: (fn: Function) => void,\n    init?: (config: any) => Promise<any>,\n    close?: () => void,\n    invoke?: () => void,\n    initLib?: (merchantId: string) => Promise<any>,\n    PAYMODE?: IStringDictionary,\n    FLOW?: IStringDictionary,\n    TOKEN?: IStringDictionary,\n    DEFERRED_EVENTS?: IStringDictionary,\n    NOTIFY_MERCHANT_EVENTS?: IStringDictionary\n}\n\nexport type Env = 'STAGE' | 'PROD';\n\n\nexport class ICheckoutOptions {\n    env?: Env;\n    openInPopup?: boolean;\n    checkoutJsInstance?: ICheckoutInstance;\n}\n\nexport class CheckoutOptions implements ICheckoutOptions{\n    public constructor(\n        public env: Env,\n        public openInPopup?: boolean,\n        public checkoutJsInstance?: ICheckoutInstance,\n    ) {\n    }\n\n    static from(options : ICheckoutOptions): CheckoutOptions{\n        options = options || {};\n        const env = options.env || <Env>CONSTANTS.ENV.PROD;\n        const openInPopup = typeof options.openInPopup === 'boolean' ? options.openInPopup : true;\n        \n        return new CheckoutOptions(\n            env,\n            openInPopup,\n            options.checkoutJsInstance\n        );\n    }\n}","import { Injectable, Inject, OnDestroy } from '@angular/core';\nimport { DOCUMENT } from '@angular/common';\nimport CONSTANTS from '../constants';\nimport { WINDOW_TOKEN, Window } from './window.service';\nimport { ReplaySubject } from 'rxjs';\nimport { ICheckoutInstance, CheckoutOptions, Env , ICheckoutOptions} from '../models';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class CheckoutService implements OnDestroy {\n  private config: any;\n  private openInPopup = true;\n  private isScriptLoaded = false;\n  private isScriptLoading = false;\n  private receivedCheckoutJsInstance: ICheckoutInstance;\n  readonly checkoutJsContainerId = CONSTANTS.IDS.CHECKOUT_ELEMENT + (new Date()).getTime();\n\n  private readonly checkoutJsInstanceSource$ = new ReplaySubject<ICheckoutInstance>(1);\n  readonly checkoutJsInstance$ = this.checkoutJsInstanceSource$.asObservable();\n\n  constructor(\n    @Inject(WINDOW_TOKEN) private readonly window: Window,\n    @Inject(DOCUMENT) private readonly document: any) {\n  }\n\n  init(config: any, options?: ICheckoutOptions): void {\n    options = CheckoutOptions.from(options);\n\n    const merchantId = config && config.merchant && config.merchant.mid;\n\n    if (merchantId) {\n      const prevMerchantId = this.config && this.config.merchant && this.config.merchant.mid;\n      this.config = config;\n      this.openInPopup = options.openInPopup;\n\n      if (options.checkoutJsInstance) {\n        this.receivedCheckoutJsInstance = options.checkoutJsInstance;\n        this.checkoutJsInstanceSource$.next(options.checkoutJsInstance);\n      }\n\n      if ((options.checkoutJsInstance || this.isScriptLoaded) && merchantId === prevMerchantId) {\n        this.initializeCheckout();\n        this.checkoutJsInstance$\n      }\n      else if (!this.isScriptLoading || (prevMerchantId && merchantId !== prevMerchantId)) {\n        this.loadCheckoutScript(merchantId, options.env);\n      }\n\n    } else {\n      console.error(CONSTANTS.ERRORS.MERCHANT_ID_NOT_FOUND);\n    }\n  }\n\n  private loadCheckoutScript(merchantId: string, env: Env): void {\n    this.isScriptLoaded = false;\n    this.isScriptLoading = true;\n    const scriptElement = this.document.createElement('script');\n    scriptElement.async = true;\n    scriptElement.src = CONSTANTS.HOSTS[env] + CONSTANTS.LINKS.CHECKOUT_JS_URL.concat(merchantId);\n    scriptElement.type = 'application/javascript';\n    scriptElement.onload = this.setupCheckoutJs;\n    scriptElement.onError = () => {\n      this.isScriptLoading = false;\n    };\n    this.document.body.appendChild(scriptElement);\n  }\n\n  private setupCheckoutJs = (): void => {\n    const checkoutJsInstance = this.getCheckoutJsObj();\n\n    if (checkoutJsInstance && checkoutJsInstance.onLoad) {\n      checkoutJsInstance.onLoad(() => {\n        this.isScriptLoaded = true;\n        this.isScriptLoading = false;\n        this.initializeCheckout();\n      });\n    }\n  }\n\n  private initializeCheckout = (): void => {\n    const checkoutJsInstance = this.getCheckoutJsObj();\n\n    if (checkoutJsInstance && checkoutJsInstance.init && checkoutJsInstance.invoke) {\n      checkoutJsInstance\n        .init({\n          ...this.config,\n          root: this.openInPopup ? '' : `#${this.checkoutJsContainerId}`\n        })\n        .then(_ => {\n          this.checkoutJsInstanceSource$.next(checkoutJsInstance);\n        })\n        .catch((error) => {\n          console.error(CONSTANTS.ERRORS.INIT, error);\n        });\n    } else {\n      console.error(CONSTANTS.ERRORS.INVALID_CHECKOUT_JS_INSTANCE);\n    }\n  }\n\n  private getCheckoutJsObj(): ICheckoutInstance | null {\n    const window = this.window;\n\n    if (this.receivedCheckoutJsInstance) {\n      return this.receivedCheckoutJsInstance;\n    }\n\n    if (window && window.Paytm && window.Paytm.CheckoutJS) {\n      return window.Paytm.CheckoutJS;\n    }\n\n    console.warn(CONSTANTS.ERRORS.CHECKOUT_NOT_AVAILABLE);\n    return null;\n  }\n\n  ngOnDestroy(): void {\n    this.checkoutJsInstanceSource$.complete();\n  }\n}\n","import { CheckoutService } from './../services/checkout.service';\nimport { Component, OnDestroy, AfterViewInit } from '@angular/core';\nimport { Subscription } from 'rxjs';\nimport CONSTANTS from '../constants';\n\n@Component({\n  selector: 'paytm-checkout',\n  template: `<div [id]=\"checkoutService.checkoutJsContainerId\"><div>`,\n})\nexport class CheckoutComponent implements AfterViewInit, OnDestroy {\n  private subs: Subscription;\n\n  constructor(readonly checkoutService: CheckoutService) {}\n\n  ngAfterViewInit(): void {\n    this.subs = this.checkoutService\n      .checkoutJsInstance$\n      .subscribe(this.invoke);\n  }\n\n  invoke(checkoutJsInstance): void {\n    if (checkoutJsInstance && checkoutJsInstance.invoke) {\n      try {\n        checkoutJsInstance.invoke();\n      } catch (error) {\n        console.error(CONSTANTS.ERRORS.INVOKE, error);\n      }\n    }\n  }\n\n  ngOnDestroy(): void {\n    if (this.subs) {\n      this.subs.unsubscribe();\n    }\n  }\n}\n","import { NgModule } from '@angular/core';\nimport { CheckoutComponent } from './components/checkout.component';\nimport { CommonModule } from '@angular/common';\n\n@NgModule({\n  declarations: [CheckoutComponent],\n  imports: [CommonModule],\n  exports: [CheckoutComponent]\n})\nexport class CheckoutModule { }\n","/*\n * Public API Surface of angular-checkout-js\n */\n\nexport * from './lib/services/checkout.service';\nexport * from './lib/components/checkout.component';\nexport * from './lib/checkout.module';\n","/**\n * Generated bundle index. Do not edit.\n */\n\nexport * from './public-api';\n\nexport {WINDOW_TOKEN as ɵb,Window as ɵa} from './lib/services/window.service';"],"names":[],"mappings":"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"}
