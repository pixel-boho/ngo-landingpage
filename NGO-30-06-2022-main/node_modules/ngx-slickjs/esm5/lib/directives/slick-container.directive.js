/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import * as tslib_1 from "tslib";
import { Directive, ElementRef, EventEmitter, Input, NgZone, Output, Inject } from '@angular/core';
import compare from 'just-compare';
import { take, map, filter, switchMap, takeUntil } from 'rxjs/operators';
import { timer, forkJoin, fromEvent, Subject } from 'rxjs';
import { LazyLoadService } from '../services/lazy-load.service';
import * as ɵngcc0 from '@angular/core';
var SlickContainerDirective = /** @class */ (function () {
    function SlickContainerDirective(elRef, zone, lazyLoadService, links) {
        this.elRef = elRef;
        this.zone = zone;
        this.lazyLoadService = lazyLoadService;
        this.links = links;
        this.config = (/** @type {?} */ ({}));
        this.afterChange = new EventEmitter();
        this.beforeChange = new EventEmitter();
        this.breakpoint = new EventEmitter();
        this.destroy = new EventEmitter();
        this.init = new EventEmitter();
        this.slides = [];
        this.initialize = false;
        this.slickCount = 0;
        this.destroy$ = new Subject();
    }
    /**
     * @return {?}
     */
    SlickContainerDirective.prototype.ngAfterViewInit = /**
     * @return {?}
     */
    function () {
        var _this = this;
        this.lazyLoadService
            .load(this.links.jquery, 'script')
            .pipe(map((/**
         * @return {?}
         */
        function () { return 'jQuery is loaded'; })), filter((/**
         * @param {?} jquery
         * @return {?}
         */
        function (jquery) { return !!jquery; })), switchMap((/**
         * @return {?}
         */
        function () {
            return forkJoin(_this.lazyLoadService.load(_this.links.slickJs, 'script'), _this.lazyLoadService.load(_this.links.slickCss, 'style'), _this.lazyLoadService.load(_this.links.slickThemeCss, 'style'));
        })), take(1))
            .subscribe((/**
         * @return {?}
         */
        function () {
            _this.initSlick();
        }));
    };
    /**
     * @return {?}
     */
    SlickContainerDirective.prototype.ngOnDestroy = /**
     * @return {?}
     */
    function () {
        this.unslick();
        this.slides = [];
        this.destroy$.next();
    };
    /**
     * @return {?}
     */
    SlickContainerDirective.prototype.initSlick = /**
     * @return {?}
     */
    function () {
        var _this = this;
        /** @type {?} */
        var that = this;
        this.zone.runOutsideAngular((/**
         * @return {?}
         */
        function () {
            $(_this.elRef.nativeElement)[0].innerHTML = '';
            _this.jQueryElement = $(_this.elRef.nativeElement);
            _this.jQueryElement.on('init', (/**
             * @param {?} event
             * @param {?} slick
             * @return {?}
             */
            function (event, slick) {
                _this.zone.run((/**
                 * @return {?}
                 */
                function () {
                    timer(0).subscribe((/**
                     * @return {?}
                     */
                    function () {
                        _this.init.emit({ event: event, slick: slick });
                        if (_this.config && _this.config.initialSlide && _this.config.initialSlide <= _this.slides.length) {
                            _this.goTo(_this.config.initialSlide);
                        }
                    }));
                }));
            }));
            _this.jQueryElement.slick(_this.config);
            _this.initialize = true;
            _this.listenMouseWheel();
            _this.jQueryElement.on('afterChange', (/**
             * @param {?} event
             * @param {?} slick
             * @param {?} currentSlide
             * @return {?}
             */
            function (event, slick, currentSlide) {
                that.zone.run((/**
                 * @return {?}
                 */
                function () {
                    that.afterChange.emit({ event: event, slick: slick, currentSlide: currentSlide });
                }));
            }));
            _this.jQueryElement.on('beforeChange', (/**
             * @param {?} event
             * @param {?} slick
             * @param {?} currentSlide
             * @param {?} nextSlide
             * @return {?}
             */
            function (event, slick, currentSlide, nextSlide) {
                that.zone.run((/**
                 * @return {?}
                 */
                function () {
                    _this.slickCount = slick.slideCount;
                    that.beforeChange.emit({ event: event, slick: slick, currentSlide: currentSlide, nextSlide: nextSlide });
                }));
            }));
            _this.jQueryElement.on('breakpoint', (/**
             * @param {?} event
             * @param {?} slick
             * @param {?} breakpoint
             * @return {?}
             */
            function (event, slick, breakpoint) {
                that.zone.run((/**
                 * @return {?}
                 */
                function () {
                    that.breakpoint.emit({ event: event, slick: slick, breakpoint: breakpoint });
                }));
            }));
            _this.jQueryElement.on('destroy', (/**
             * @param {?} event
             * @param {?} slick
             * @return {?}
             */
            function (event, slick) {
                that.zone.run((/**
                 * @return {?}
                 */
                function () {
                    that.destroy.emit({ event: event, slick: slick });
                }));
            }));
        }));
        this.syncSlides();
    };
    /**
     * @return {?}
     */
    SlickContainerDirective.prototype.syncSlides = /**
     * @return {?}
     */
    function () {
        var _this = this;
        if (this.slickCount >= this.slides.length)
            return;
        this.slides.forEach((/**
         * @param {?} slide
         * @return {?}
         */
        function (slide) {
            _this.zone.run((/**
             * @return {?}
             */
            function () {
                _this.jQueryElement.slick('slickAdd', slide);
            }));
        }));
    };
    /**
     * @param {?} slide
     * @return {?}
     */
    SlickContainerDirective.prototype.addSlide = /**
     * @param {?} slide
     * @return {?}
     */
    function (slide) {
        var _this = this;
        this.slides = tslib_1.__spread(this.slides, [slide]);
        if (!this.initialize)
            return;
        this.zone.run((/**
         * @return {?}
         */
        function () {
            _this.jQueryElement.slick('slickAdd', slide);
        }));
    };
    /**
     * @param {?} slide
     * @return {?}
     */
    SlickContainerDirective.prototype.removeSlide = /**
     * @param {?} slide
     * @return {?}
     */
    function (slide) {
        var _this = this;
        this.slides = this.slides.filter((/**
         * @param {?} slide
         * @return {?}
         */
        function (slide) { return compare(slide, slide); }));
        if (!this.initialize)
            return;
        this.zone.run((/**
         * @return {?}
         */
        function () {
            _this.jQueryElement.slick('slickRemove', _this.slides.indexOf(slide));
        }));
    };
    /**
     * @param {?} index
     * @return {?}
     */
    SlickContainerDirective.prototype.goTo = /**
     * @param {?} index
     * @return {?}
     */
    function (index) {
        var _this = this;
        this.zone.run((/**
         * @return {?}
         */
        function () {
            _this.jQueryElement.slick('slickGoTo', index);
        }));
    };
    /**
     * @return {?}
     */
    SlickContainerDirective.prototype.next = /**
     * @return {?}
     */
    function () {
        var _this = this;
        this.zone.run((/**
         * @return {?}
         */
        function () {
            _this.jQueryElement.slick('slickNext');
        }));
    };
    /**
     * @return {?}
     */
    SlickContainerDirective.prototype.prev = /**
     * @return {?}
     */
    function () {
        var _this = this;
        this.zone.run((/**
         * @return {?}
         */
        function () {
            _this.jQueryElement.slick('slickPrev');
        }));
    };
    /**
     * @return {?}
     */
    SlickContainerDirective.prototype.pause = /**
     * @return {?}
     */
    function () {
        var _this = this;
        this.zone.run((/**
         * @return {?}
         */
        function () {
            _this.jQueryElement.slick('slickPause');
        }));
    };
    /**
     * @return {?}
     */
    SlickContainerDirective.prototype.play = /**
     * @return {?}
     */
    function () {
        var _this = this;
        this.zone.run((/**
         * @return {?}
         */
        function () {
            _this.jQueryElement.slick('slickPlay');
        }));
    };
    /**
     * @return {?}
     */
    SlickContainerDirective.prototype.unslick = /**
     * @return {?}
     */
    function () {
        var _this = this;
        if (this.jQueryElement) {
            this.zone.run((/**
             * @return {?}
             */
            function () {
                _this.jQueryElement.slick('unslick');
            }));
        }
        this.initialize = false;
    };
    /**
     * @return {?}
     */
    SlickContainerDirective.prototype.listenMouseWheel = /**
     * @return {?}
     */
    function () {
        var _this = this;
        if (this.config.mouseWheelMove === false)
            return;
        fromEvent(this.elRef.nativeElement, 'wheel')
            .pipe(takeUntil(this.destroy$))
            .subscribe((/**
         * @param {?} event
         * @return {?}
         */
        function (event) {
            event.preventDefault();
            if (event.deltaX > 0 || event.deltaY < 0) {
                _this.prev();
            }
            else if (event.deltaX < 0 || event.deltaY > 0) {
                _this.next();
            }
        }));
    };
    /** @nocollapse */
    SlickContainerDirective.ctorParameters = function () { return [
        { type: ElementRef },
        { type: NgZone },
        { type: LazyLoadService },
        { type: undefined, decorators: [{ type: Inject, args: ['slick-links',] }] }
    ]; };
    SlickContainerDirective.propDecorators = {
        config: [{ type: Input, args: ['slickConfig',] }],
        afterChange: [{ type: Output, args: ['slickAfterChange',] }],
        beforeChange: [{ type: Output, args: ['slickBeforeChange',] }],
        breakpoint: [{ type: Output, args: ['slickBreakpoint',] }],
        destroy: [{ type: Output, args: ['slickDestroy',] }],
        init: [{ type: Output, args: ['slickInit',] }]
    };
SlickContainerDirective.ɵfac = function SlickContainerDirective_Factory(t) { return new (t || SlickContainerDirective)(ɵngcc0.ɵɵdirectiveInject(ɵngcc0.ElementRef), ɵngcc0.ɵɵdirectiveInject(ɵngcc0.NgZone), ɵngcc0.ɵɵdirectiveInject(LazyLoadService), ɵngcc0.ɵɵdirectiveInject('slick-links')); };
SlickContainerDirective.ɵdir = ɵngcc0.ɵɵdefineDirective({ type: SlickContainerDirective, selectors: [["", "slickContainer", ""]], inputs: { config: ["slickConfig", "config"] }, outputs: { afterChange: "slickAfterChange", beforeChange: "slickBeforeChange", breakpoint: "slickBreakpoint", destroy: "slickDestroy", init: "slickInit" }, exportAs: ["slick"] });
/*@__PURE__*/ (function () { ɵngcc0.ɵsetClassMetadata(SlickContainerDirective, [{
        type: Directive,
        args: [{
                selector: '[slickContainer]',
                exportAs: 'slick'
            }]
    }], function () { return [{ type: ɵngcc0.ElementRef }, { type: ɵngcc0.NgZone }, { type: LazyLoadService }, { type: undefined, decorators: [{
                type: Inject,
                args: ['slick-links']
            }] }]; }, { config: [{
            type: Input,
            args: ['slickConfig']
        }], afterChange: [{
            type: Output,
            args: ['slickAfterChange']
        }], beforeChange: [{
            type: Output,
            args: ['slickBeforeChange']
        }], breakpoint: [{
            type: Output,
            args: ['slickBreakpoint']
        }], destroy: [{
            type: Output,
            args: ['slickDestroy']
        }], init: [{
            type: Output,
            args: ['slickInit']
        }] }); })();
    return SlickContainerDirective;
}());
export { SlickContainerDirective };
if (false) {
    /** @type {?} */
    SlickContainerDirective.prototype.config;
    /** @type {?} */
    SlickContainerDirective.prototype.afterChange;
    /** @type {?} */
    SlickContainerDirective.prototype.beforeChange;
    /** @type {?} */
    SlickContainerDirective.prototype.breakpoint;
    /** @type {?} */
    SlickContainerDirective.prototype.destroy;
    /** @type {?} */
    SlickContainerDirective.prototype.init;
    /** @type {?} */
    SlickContainerDirective.prototype.slides;
    /** @type {?} */
    SlickContainerDirective.prototype.jQueryElement;
    /** @type {?} */
    SlickContainerDirective.prototype.initialize;
    /** @type {?} */
    SlickContainerDirective.prototype.slickCount;
    /**
     * @type {?}
     * @private
     */
    SlickContainerDirective.prototype.destroy$;
    /**
     * @type {?}
     * @private
     */
    SlickContainerDirective.prototype.elRef;
    /**
     * @type {?}
     * @private
     */
    SlickContainerDirective.prototype.zone;
    /**
     * @type {?}
     * @private
     */
    SlickContainerDirective.prototype.lazyLoadService;
    /**
     * @type {?}
     * @private
     */
    SlickContainerDirective.prototype.links;
}

//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2xpY2stY29udGFpbmVyLmRpcmVjdGl2ZS5qcyIsInNvdXJjZXMiOlsibmc6L25neC1zbGlja2pzL2xpYi9kaXJlY3RpdmVzL3NsaWNrLWNvbnRhaW5lci5kaXJlY3RpdmUudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7QUFBQSxPQUFPLEVBQUUsU0FBUyxFQUFFLFVBQVUsRUFBRSxZQUFZLEVBQUUsS0FBSyxFQUFFLE1BQU0sRUFBYSxNQUFNLEVBQUUsTUFBTSxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBQzlHLE9BQU8sT0FBTyxNQUFNLGNBQWMsQ0FBQztBQUNuQyxPQUFPLEVBQUUsSUFBSSxFQUFFLEdBQUcsRUFBRSxNQUFNLEVBQUUsU0FBUyxFQUFFLFNBQVMsRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBR3pFLE9BQU8sRUFBRSxLQUFLLEVBQUUsUUFBUSxFQUFFLFNBQVMsRUFBRSxPQUFPLEVBQUUsTUFBTSxNQUFNLENBQUM7QUFDM0QsT0FBTyxFQUFFLGVBQWUsRUFBRSxNQUFNLCtCQUErQixDQUFDOztBQUloRTtBQUVjLElBK0JaLGlDQUNVLEtBQWlCLEVBQ2pCLElBQVksRUFDWixlQUFnQyxFQUNULEtBQW9CO0FBQ3JELFFBSlUsVUFBSyxHQUFMLEtBQUssQ0FBWTtBQUFDLFFBQ2xCLFNBQUksR0FBSixJQUFJLENBQVE7QUFBQyxRQUNiLG9CQUFlLEdBQWYsZUFBZSxDQUFpQjtBQUFDLFFBQ1YsVUFBSyxHQUFMLEtBQUssQ0FBZTtBQUFDLFFBL0J0RCxXQUFNLEdBQUcsbUJBQUEsRUFBRSxFQUFnQixDQUFDO0FBQzlCLFFBRUUsZ0JBQVcsR0FBc0IsSUFBSSxZQUFZLEVBQUUsQ0FBQztBQUN0RCxRQUVFLGlCQUFZLEdBQXNCLElBQUksWUFBWSxFQUFFLENBQUM7QUFDdkQsUUFFRSxlQUFVLEdBQXNCLElBQUksWUFBWSxFQUFFLENBQUM7QUFDckQsUUFFRSxZQUFPLEdBQXNCLElBQUksWUFBWSxFQUFFLENBQUM7QUFDbEQsUUFFRSxTQUFJLEdB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OEJBRUYsTUFBTSxTQUFDLGtCQUFrQjtBQUN2QiwrQkFFRixNQUFNLFNBQUMsbUJBQW1CO0FBQ3hCLDZCQUVGLE1BQU0sU0FBQyxpQkFBaUI7QUFDdEIsMEJBRUYsTUFBTSxTQUFDLGNBQWM7QUFDbkIsdUJBRUYsTUFBTSxTQUFDLFdBQVc7QUFDakI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztvQkFBTTtBQUFDLElBa0xYLDhCQUFDO0FBQ0EsQ0FEQSxBQXZNRCxJQXVNQztBQUNELFNBcE1hLHVCQUF1QjtBQUFJO0FBQWE7QUFDdkMsSUFBWix5Q0FDNEI7QUFDOUI7QUFDb0IsSUFBbEIsOENBQ29EO0FBQ3REO0FBQ29CLElBQWxCLCtDQUNxRDtBQUN2RDtBQUNvQixJQUFsQiw2Q0FDbUQ7QUFDckQ7QUFDb0IsSUFBbEIsMENBQ2dEO0FBQ2xEO0FBQ29CLElBQWxCLHVDQUM2QztBQUMvQztBQUNvQixJQUFsQix5Q0FBMkI7QUFDN0I7QUFDb0IsSUFBbEIsZ0RBQW1CO0FBQ3JCO0FBQ29CLElBQWxCLDZDQUE0QjtBQUM5QjtBQUNvQixJQUFsQiw2Q0FBdUI7QUFDekI7QUFDTztBQUFpQjtBQUVyQjtBQUFRLElBRlQsMkNBQWlDO0FBQ25DO0FBQ087QUFDRTtBQUFnQjtBQUN2QixJQURFLHdDQUF5QjtBQUFDO0FBQ3ZCO0FBQWlCO0FBQ1Y7QUFBUSxJQURsQix1Q0FBb0I7QUFBQztBQUNsQjtBQUFpQjtBQUFnQjtBQUN0QyxJQURFLGtEQUF3QztBQUFDO0FBQ3RDO0FBQWlCO0FBQWdCO0FBQVEsSUFBNUMsd0NBQW1EO0FBQUM7QUFDdkQiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBEaXJlY3RpdmUsIEVsZW1lbnRSZWYsIEV2ZW50RW1pdHRlciwgSW5wdXQsIE5nWm9uZSwgT25EZXN0cm95LCBPdXRwdXQsIEluamVjdCB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IGNvbXBhcmUgZnJvbSAnanVzdC1jb21wYXJlJztcbmltcG9ydCB7IHRha2UsIG1hcCwgZmlsdGVyLCBzd2l0Y2hNYXAsIHRha2VVbnRpbCB9IGZyb20gJ3J4anMvb3BlcmF0b3JzJztcbmltcG9ydCB7IE9wdGlvbnMgfSBmcm9tICcuLi9tb2RlbHMvb3B0aW9ucyc7XG5pbXBvcnQgeyBTbGljayB9IGZyb20gJy4uL21vZGVscy9zbGljayc7XG5pbXBvcnQgeyB0aW1lciwgZm9ya0pvaW4sIGZyb21FdmVudCwgU3ViamVjdCB9IGZyb20gJ3J4anMnO1xuaW1wb3J0IHsgTGF6eUxvYWRTZXJ2aWNlIH0gZnJvbSAnLi4vc2VydmljZXMvbGF6eS1sb2FkLnNlcnZpY2UnO1xuXG5kZWNsYXJlIGNvbnN0ICQ6IGFueTtcblxuQERpcmVjdGl2ZSh7XG4gIHNlbGVjdG9yOiAnW3NsaWNrQ29udGFpbmVyXScsXG4gIGV4cG9ydEFzOiAnc2xpY2snLFxufSlcbmV4cG9ydCBjbGFzcyBTbGlja0NvbnRhaW5lckRpcmVjdGl2ZSBpbXBsZW1lbnRzIE9uRGVzdHJveSB7XG4gIEBJbnB1dCgnc2xpY2tDb25maWcnKVxuICBjb25maWcgPSB7fSBhcyBTbGljay5Db25maWc7XG5cbiAgQE91dHB1dCgnc2xpY2tBZnRlckNoYW5nZScpXG4gIGFmdGVyQ2hhbmdlOiBFdmVudEVtaXR0ZXI8YW55PiA9IG5ldyBFdmVudEVtaXR0ZXIoKTtcblxuICBAT3V0cHV0KCdzbGlja0JlZm9yZUNoYW5nZScpXG4gIGJlZm9yZUNoYW5nZTogRXZlbnRFbWl0dGVyPGFueT4gPSBuZXcgRXZlbnRFbWl0dGVyKCk7XG5cbiAgQE91dHB1dCgnc2xpY2tCcmVha3BvaW50JylcbiAgYnJlYWtwb2ludDogRXZlbnRFbWl0dGVyPGFueT4gPSBuZXcgRXZlbnRFbWl0dGVyKCk7XG5cbiAgQE91dHB1dCgnc2xpY2tEZXN0cm95JylcbiAgZGVzdHJveTogRXZlbnRFbWl0dGVyPGFueT4gPSBuZXcgRXZlbnRFbWl0dGVyKCk7XG5cbiAgQE91dHB1dCgnc2xpY2tJbml0JylcbiAgaW5pdDogRXZlbnRFbWl0dGVyPGFueT4gPSBuZXcgRXZlbnRFbWl0dGVyKCk7XG5cbiAgc2xpZGVzOiBIVE1MRWxlbWVudFtdID0gW107XG5cbiAgalF1ZXJ5RWxlbWVudDogYW55O1xuXG4gIGluaXRpYWxpemU6IGJvb2xlYW4gPSBmYWxzZTtcblxuICBzbGlja0NvdW50OiBudW1iZXIgPSAwO1xuXG4gIHByaXZhdGUgZGVzdHJveSQgPSBuZXcgU3ViamVjdCgpO1xuXG4gIGNvbnN0cnVjdG9yKFxuICAgIHByaXZhdGUgZWxSZWY6IEVsZW1lbnRSZWYsXG4gICAgcHJpdmF0ZSB6b25lOiBOZ1pvbmUsXG4gICAgcHJpdmF0ZSBsYXp5TG9hZFNlcnZpY2U6IExhenlMb2FkU2VydmljZSxcbiAgICBASW5qZWN0KCdzbGljay1saW5rcycpIHByaXZhdGUgbGlua3M6IE9wdGlvbnMuTGlua3MsXG4gICkge31cblxuICBuZ0FmdGVyVmlld0luaXQoKSB7XG4gICAgdGhpcy5sYXp5TG9hZFNlcnZpY2VcbiAgICAgIC5sb2FkKHRoaXMubGlua3MuanF1ZXJ5LCAnc2NyaXB0JylcbiAgICAgIC5waXBlKFxuICAgICAgICBtYXAoKCkgPT4gJ2pRdWVyeSBpcyBsb2FkZWQnKSxcbiAgICAgICAgZmlsdGVyKGpxdWVyeSA9PiAhIWpxdWVyeSksXG4gICAgICAgIHN3aXRjaE1hcCgoKSA9PlxuICAgICAgICAgIGZvcmtKb2luKFxuICAgICAgICAgICAgdGhpcy5sYXp5TG9hZFNlcnZpY2UubG9hZCh0aGlzLmxpbmtzLnNsaWNrSnMsICdzY3JpcHQnKSxcbiAgICAgICAgICAgIHRoaXMubGF6eUxvYWRTZXJ2aWNlLmxvYWQodGhpcy5saW5rcy5zbGlja0NzcywgJ3N0eWxlJyksXG4gICAgICAgICAgICB0aGlzLmxhenlMb2FkU2VydmljZS5sb2FkKHRoaXMubGlua3Muc2xpY2tUaGVtZUNzcywgJ3N0eWxlJyksXG4gICAgICAgICAgKSxcbiAgICAgICAgKSxcbiAgICAgICAgdGFrZSgxKSxcbiAgICAgIClcbiAgICAgIC5zdWJzY3JpYmUoKCkgPT4ge1xuICAgICAgICB0aGlzLmluaXRTbGljaygpO1xuICAgICAgfSk7XG4gIH1cblxuICBuZ09uRGVzdHJveSgpIHtcbiAgICB0aGlzLnVuc2xpY2soKTtcbiAgICB0aGlzLnNsaWRlcyA9IFtdO1xuICAgIHRoaXMuZGVzdHJveSQubmV4dCgpO1xuICB9XG5cbiAgaW5pdFNsaWNrKCkge1xuICAgIGNvbnN0IHRoYXQgPSB0aGlzO1xuICAgIHRoaXMuem9uZS5ydW5PdXRzaWRlQW5ndWxhcigoKSA9PiB7XG4gICAgICAkKHRoaXMuZWxSZWYubmF0aXZlRWxlbWVudClbMF0uaW5uZXJIVE1MID0gJyc7XG4gICAgICB0aGlzLmpRdWVyeUVsZW1lbnQgPSAkKHRoaXMuZWxSZWYubmF0aXZlRWxlbWVudCk7XG4gICAgICB0aGlzLmpRdWVyeUVsZW1lbnQub24oJ2luaXQnLCAoZXZlbnQsIHNsaWNrKSA9PiB7XG4gICAgICAgIHRoaXMuem9uZS5ydW4oKCkgPT4ge1xuICAgICAgICAgIHRpbWVyKDApLnN1YnNjcmliZSgoKSA9PiB7XG4gICAgICAgICAgICB0aGlzLmluaXQuZW1pdCh7IGV2ZW50LCBzbGljayB9KTtcblxuICAgICAgICAgICAgaWYgKHRoaXMuY29uZmlnICYmIHRoaXMuY29uZmlnLmluaXRpYWxTbGlkZSAmJiB0aGlzLmNvbmZpZy5pbml0aWFsU2xpZGUgPD0gdGhpcy5zbGlkZXMubGVuZ3RoKSB7XG4gICAgICAgICAgICAgIHRoaXMuZ29Ubyh0aGlzLmNvbmZpZy5pbml0aWFsU2xpZGUpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICAgIH0pO1xuXG4gICAgICB0aGlzLmpRdWVyeUVsZW1lbnQuc2xpY2sodGhpcy5jb25maWcpO1xuICAgICAgdGhpcy5pbml0aWFsaXplID0gdHJ1ZTtcbiAgICAgIHRoaXMubGlzdGVuTW91c2VXaGVlbCgpO1xuXG4gICAgICB0aGlzLmpRdWVyeUVsZW1lbnQub24oJ2FmdGVyQ2hhbmdlJywgKGV2ZW50LCBzbGljaywgY3VycmVudFNsaWRlKSA9PiB7XG4gICAgICAgIHRoYXQuem9uZS5ydW4oKCkgPT4ge1xuICAgICAgICAgIHRoYXQuYWZ0ZXJDaGFuZ2UuZW1pdCh7IGV2ZW50LCBzbGljaywgY3VycmVudFNsaWRlIH0pO1xuICAgICAgICB9KTtcbiAgICAgIH0pO1xuXG4gICAgICB0aGlzLmpRdWVyeUVsZW1lbnQub24oJ2JlZm9yZUNoYW5nZScsIChldmVudCwgc2xpY2ssIGN1cnJlbnRTbGlkZSwgbmV4dFNsaWRlKSA9PiB7XG4gICAgICAgIHRoYXQuem9uZS5ydW4oKCkgPT4ge1xuICAgICAgICAgIHRoaXMuc2xpY2tDb3VudCA9IHNsaWNrLnNsaWRlQ291bnQ7XG4gICAgICAgICAgdGhhdC5iZWZvcmVDaGFuZ2UuZW1pdCh7IGV2ZW50LCBzbGljaywgY3VycmVudFNsaWRlLCBuZXh0U2xpZGUgfSk7XG4gICAgICAgIH0pO1xuICAgICAgfSk7XG5cbiAgICAgIHRoaXMualF1ZXJ5RWxlbWVudC5vbignYnJlYWtwb2ludCcsIChldmVudCwgc2xpY2ssIGJyZWFrcG9pbnQpID0+IHtcbiAgICAgICAgdGhhdC56b25lLnJ1bigoKSA9PiB7XG4gICAgICAgICAgdGhhdC5icmVha3BvaW50LmVtaXQoeyBldmVudCwgc2xpY2ssIGJyZWFrcG9pbnQgfSk7XG4gICAgICAgIH0pO1xuICAgICAgfSk7XG5cbiAgICAgIHRoaXMualF1ZXJ5RWxlbWVudC5vbignZGVzdHJveScsIChldmVudCwgc2xpY2spID0+IHtcbiAgICAgICAgdGhhdC56b25lLnJ1bigoKSA9PiB7XG4gICAgICAgICAgdGhhdC5kZXN0cm95LmVtaXQoeyBldmVudCwgc2xpY2sgfSk7XG4gICAgICAgIH0pO1xuICAgICAgfSk7XG4gICAgfSk7XG5cbiAgICB0aGlzLnN5bmNTbGlkZXMoKTtcbiAgfVxuXG4gIHN5bmNTbGlkZXMoKSB7XG4gICAgaWYgKHRoaXMuc2xpY2tDb3VudCA+PSB0aGlzLnNsaWRlcy5sZW5ndGgpIHJldHVybjtcblxuICAgIHRoaXMuc2xpZGVzLmZvckVhY2goc2xpZGUgPT4ge1xuICAgICAgdGhpcy56b25lLnJ1bigoKSA9PiB7XG4gICAgICAgIHRoaXMualF1ZXJ5RWxlbWVudC5zbGljaygnc2xpY2tBZGQnLCBzbGlkZSk7XG4gICAgICB9KTtcbiAgICB9KTtcbiAgfVxuXG4gIGFkZFNsaWRlKHNsaWRlOiBIVE1MRWxlbWVudCkge1xuICAgIHRoaXMuc2xpZGVzID0gWy4uLnRoaXMuc2xpZGVzLCBzbGlkZV07XG5cbiAgICBpZiAoIXRoaXMuaW5pdGlhbGl6ZSkgcmV0dXJuO1xuXG4gICAgdGhpcy56b25lLnJ1bigoKSA9PiB7XG4gICAgICB0aGlzLmpRdWVyeUVsZW1lbnQuc2xpY2soJ3NsaWNrQWRkJywgc2xpZGUpO1xuICAgIH0pO1xuICB9XG5cbiAgcmVtb3ZlU2xpZGUoc2xpZGU6IEhUTUxFbGVtZW50KSB7XG4gICAgdGhpcy5zbGlkZXMgPSB0aGlzLnNsaWRlcy5maWx0ZXIoc2xpZGUgPT4gY29tcGFyZShzbGlkZSwgc2xpZGUpKTtcblxuICAgIGlmICghdGhpcy5pbml0aWFsaXplKSByZXR1cm47XG5cbiAgICB0aGlzLnpvbmUucnVuKCgpID0+IHtcbiAgICAgIHRoaXMualF1ZXJ5RWxlbWVudC5zbGljaygnc2xpY2tSZW1vdmUnLCB0aGlzLnNsaWRlcy5pbmRleE9mKHNsaWRlKSk7XG4gICAgfSk7XG4gIH1cblxuICBnb1RvKGluZGV4OiBudW1iZXIpIHtcbiAgICB0aGlzLnpvbmUucnVuKCgpID0+IHtcbiAgICAgIHRoaXMualF1ZXJ5RWxlbWVudC5zbGljaygnc2xpY2tHb1RvJywgaW5kZXgpO1xuICAgIH0pO1xuICB9XG5cbiAgbmV4dCgpIHtcbiAgICB0aGlzLnpvbmUucnVuKCgpID0+IHtcbiAgICAgIHRoaXMualF1ZXJ5RWxlbWVudC5zbGljaygnc2xpY2tOZXh0Jyk7XG4gICAgfSk7XG4gIH1cblxuICBwcmV2KCkge1xuICAgIHRoaXMuem9uZS5ydW4oKCkgPT4ge1xuICAgICAgdGhpcy5qUXVlcnlFbGVtZW50LnNsaWNrKCdzbGlja1ByZXYnKTtcbiAgICB9KTtcbiAgfVxuXG4gIHBhdXNlKCkge1xuICAgIHRoaXMuem9uZS5ydW4oKCkgPT4ge1xuICAgICAgdGhpcy5qUXVlcnlFbGVtZW50LnNsaWNrKCdzbGlja1BhdXNlJyk7XG4gICAgfSk7XG4gIH1cblxuICBwbGF5KCkge1xuICAgIHRoaXMuem9uZS5ydW4oKCkgPT4ge1xuICAgICAgdGhpcy5qUXVlcnlFbGVtZW50LnNsaWNrKCdzbGlja1BsYXknKTtcbiAgICB9KTtcbiAgfVxuXG4gIHVuc2xpY2soKSB7XG4gICAgaWYgKHRoaXMualF1ZXJ5RWxlbWVudCkge1xuICAgICAgdGhpcy56b25lLnJ1bigoKSA9PiB7XG4gICAgICAgIHRoaXMualF1ZXJ5RWxlbWVudC5zbGljaygndW5zbGljaycpO1xuICAgICAgfSk7XG4gICAgfVxuICAgIHRoaXMuaW5pdGlhbGl6ZSA9IGZhbHNlO1xuICB9XG5cbiAgbGlzdGVuTW91c2VXaGVlbCgpIHtcbiAgICBpZiAodGhpcy5jb25maWcubW91c2VXaGVlbE1vdmUgPT09IGZhbHNlKSByZXR1cm47XG5cbiAgICBmcm9tRXZlbnQodGhpcy5lbFJlZi5uYXRpdmVFbGVtZW50LCAnd2hlZWwnKVxuICAgICAgLnBpcGUodGFrZVVudGlsKHRoaXMuZGVzdHJveSQpKVxuICAgICAgLnN1YnNjcmliZSgoZXZlbnQ6IE1vdXNlV2hlZWxFdmVudCkgPT4ge1xuICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICBpZiAoZXZlbnQuZGVsdGFYID4gMCB8fCBldmVudC5kZWx0YVkgPCAwKSB7XG4gICAgICAgICAgdGhpcy5wcmV2KCk7XG4gICAgICAgIH0gZWxzZSBpZiAoZXZlbnQuZGVsdGFYIDwgMCB8fCBldmVudC5kZWx0YVkgPiAwKSB7XG4gICAgICAgICAgdGhpcy5uZXh0KCk7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICB9XG59XG4iXX0=