/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Directive, ElementRef, EventEmitter, Input, NgZone, Output, Inject } from '@angular/core';
import compare from 'just-compare';
import { take, map, filter, switchMap, takeUntil } from 'rxjs/operators';
import { timer, forkJoin, fromEvent, Subject } from 'rxjs';
import { LazyLoadService } from '../services/lazy-load.service';
import * as ɵngcc0 from '@angular/core';
export class SlickContainerDirective {
    /**
     * @param {?} elRef
     * @param {?} zone
     * @param {?} lazyLoadService
     * @param {?} links
     */
    constructor(elRef, zone, lazyLoadService, links) {
        this.elRef = elRef;
        this.zone = zone;
        this.lazyLoadService = lazyLoadService;
        this.links = links;
        this.config = (/** @type {?} */ ({}));
        this.afterChange = new EventEmitter();
        this.beforeChange = new EventEmitter();
        this.breakpoint = new EventEmitter();
        this.destroy = new EventEmitter();
        this.init = new EventEmitter();
        this.slides = [];
        this.initialize = false;
        this.slickCount = 0;
        this.destroy$ = new Subject();
    }
    /**
     * @return {?}
     */
    ngAfterViewInit() {
        this.lazyLoadService
            .load(this.links.jquery, 'script')
            .pipe(map((/**
         * @return {?}
         */
        () => 'jQuery is loaded')), filter((/**
         * @param {?} jquery
         * @return {?}
         */
        jquery => !!jquery)), switchMap((/**
         * @return {?}
         */
        () => forkJoin(this.lazyLoadService.load(this.links.slickJs, 'script'), this.lazyLoadService.load(this.links.slickCss, 'style'), this.lazyLoadService.load(this.links.slickThemeCss, 'style')))), take(1))
            .subscribe((/**
         * @return {?}
         */
        () => {
            this.initSlick();
        }));
    }
    /**
     * @return {?}
     */
    ngOnDestroy() {
        this.unslick();
        this.slides = [];
        this.destroy$.next();
    }
    /**
     * @return {?}
     */
    initSlick() {
        /** @type {?} */
        const that = this;
        this.zone.runOutsideAngular((/**
         * @return {?}
         */
        () => {
            $(this.elRef.nativeElement)[0].innerHTML = '';
            this.jQueryElement = $(this.elRef.nativeElement);
            this.jQueryElement.on('init', (/**
             * @param {?} event
             * @param {?} slick
             * @return {?}
             */
            (event, slick) => {
                this.zone.run((/**
                 * @return {?}
                 */
                () => {
                    timer(0).subscribe((/**
                     * @return {?}
                     */
                    () => {
                        this.init.emit({ event, slick });
                        if (this.config && this.config.initialSlide && this.config.initialSlide <= this.slides.length) {
                            this.goTo(this.config.initialSlide);
                        }
                    }));
                }));
            }));
            this.jQueryElement.slick(this.config);
            this.initialize = true;
            this.listenMouseWheel();
            this.jQueryElement.on('afterChange', (/**
             * @param {?} event
             * @param {?} slick
             * @param {?} currentSlide
             * @return {?}
             */
            (event, slick, currentSlide) => {
                that.zone.run((/**
                 * @return {?}
                 */
                () => {
                    that.afterChange.emit({ event, slick, currentSlide });
                }));
            }));
            this.jQueryElement.on('beforeChange', (/**
             * @param {?} event
             * @param {?} slick
             * @param {?} currentSlide
             * @param {?} nextSlide
             * @return {?}
             */
            (event, slick, currentSlide, nextSlide) => {
                that.zone.run((/**
                 * @return {?}
                 */
                () => {
                    this.slickCount = slick.slideCount;
                    that.beforeChange.emit({ event, slick, currentSlide, nextSlide });
                }));
            }));
            this.jQueryElement.on('breakpoint', (/**
             * @param {?} event
             * @param {?} slick
             * @param {?} breakpoint
             * @return {?}
             */
            (event, slick, breakpoint) => {
                that.zone.run((/**
                 * @return {?}
                 */
                () => {
                    that.breakpoint.emit({ event, slick, breakpoint });
                }));
            }));
            this.jQueryElement.on('destroy', (/**
             * @param {?} event
             * @param {?} slick
             * @return {?}
             */
            (event, slick) => {
                that.zone.run((/**
                 * @return {?}
                 */
                () => {
                    that.destroy.emit({ event, slick });
                }));
            }));
        }));
        this.syncSlides();
    }
    /**
     * @return {?}
     */
    syncSlides() {
        if (this.slickCount >= this.slides.length)
            return;
        this.slides.forEach((/**
         * @param {?} slide
         * @return {?}
         */
        slide => {
            this.zone.run((/**
             * @return {?}
             */
            () => {
                this.jQueryElement.slick('slickAdd', slide);
            }));
        }));
    }
    /**
     * @param {?} slide
     * @return {?}
     */
    addSlide(slide) {
        this.slides = [...this.slides, slide];
        if (!this.initialize)
            return;
        this.zone.run((/**
         * @return {?}
         */
        () => {
            this.jQueryElement.slick('slickAdd', slide);
        }));
    }
    /**
     * @param {?} slide
     * @return {?}
     */
    removeSlide(slide) {
        this.slides = this.slides.filter((/**
         * @param {?} slide
         * @return {?}
         */
        slide => compare(slide, slide)));
        if (!this.initialize)
            return;
        this.zone.run((/**
         * @return {?}
         */
        () => {
            this.jQueryElement.slick('slickRemove', this.slides.indexOf(slide));
        }));
    }
    /**
     * @param {?} index
     * @return {?}
     */
    goTo(index) {
        this.zone.run((/**
         * @return {?}
         */
        () => {
            this.jQueryElement.slick('slickGoTo', index);
        }));
    }
    /**
     * @return {?}
     */
    next() {
        this.zone.run((/**
         * @return {?}
         */
        () => {
            this.jQueryElement.slick('slickNext');
        }));
    }
    /**
     * @return {?}
     */
    prev() {
        this.zone.run((/**
         * @return {?}
         */
        () => {
            this.jQueryElement.slick('slickPrev');
        }));
    }
    /**
     * @return {?}
     */
    pause() {
        this.zone.run((/**
         * @return {?}
         */
        () => {
            this.jQueryElement.slick('slickPause');
        }));
    }
    /**
     * @return {?}
     */
    play() {
        this.zone.run((/**
         * @return {?}
         */
        () => {
            this.jQueryElement.slick('slickPlay');
        }));
    }
    /**
     * @return {?}
     */
    unslick() {
        if (this.jQueryElement) {
            this.zone.run((/**
             * @return {?}
             */
            () => {
                this.jQueryElement.slick('unslick');
            }));
        }
        this.initialize = false;
    }
    /**
     * @return {?}
     */
    listenMouseWheel() {
        if (this.config.mouseWheelMove === false)
            return;
        fromEvent(this.elRef.nativeElement, 'wheel')
            .pipe(takeUntil(this.destroy$))
            .subscribe((/**
         * @param {?} event
         * @return {?}
         */
        (event) => {
            event.preventDefault();
            if (event.deltaX > 0 || event.deltaY < 0) {
                this.prev();
            }
            else if (event.deltaX < 0 || event.deltaY > 0) {
                this.next();
            }
        }));
    }
}
SlickContainerDirective.ɵfac = function SlickContainerDirective_Factory(t) { return new (t || SlickContainerDirective)(ɵngcc0.ɵɵdirectiveInject(ɵngcc0.ElementRef), ɵngcc0.ɵɵdirectiveInject(ɵngcc0.NgZone), ɵngcc0.ɵɵdirectiveInject(LazyLoadService), ɵngcc0.ɵɵdirectiveInject('slick-links')); };
SlickContainerDirective.ɵdir = ɵngcc0.ɵɵdefineDirective({ type: SlickContainerDirective, selectors: [["", "slickContainer", ""]], inputs: { config: ["slickConfig", "config"] }, outputs: { afterChange: "slickAfterChange", beforeChange: "slickBeforeChange", breakpoint: "slickBreakpoint", destroy: "slickDestroy", init: "slickInit" }, exportAs: ["slick"] });
/** @nocollapse */
SlickContainerDirective.ctorParameters = () => [
    { type: ElementRef },
    { type: NgZone },
    { type: LazyLoadService },
    { type: undefined, decorators: [{ type: Inject, args: ['slick-links',] }] }
];
SlickContainerDirective.propDecorators = {
    config: [{ type: Input, args: ['slickConfig',] }],
    afterChange: [{ type: Output, args: ['slickAfterChange',] }],
    beforeChange: [{ type: Output, args: ['slickBeforeChange',] }],
    breakpoint: [{ type: Output, args: ['slickBreakpoint',] }],
    destroy: [{ type: Output, args: ['slickDestroy',] }],
    init: [{ type: Output, args: ['slickInit',] }]
};
/*@__PURE__*/ (function () { ɵngcc0.ɵsetClassMetadata(SlickContainerDirective, [{
        type: Directive,
        args: [{
                selector: '[slickContainer]',
                exportAs: 'slick'
            }]
    }], function () { return [{ type: ɵngcc0.ElementRef }, { type: ɵngcc0.NgZone }, { type: LazyLoadService }, { type: undefined, decorators: [{
                type: Inject,
                args: ['slick-links']
            }] }]; }, { config: [{
            type: Input,
            args: ['slickConfig']
        }], afterChange: [{
            type: Output,
            args: ['slickAfterChange']
        }], beforeChange: [{
            type: Output,
            args: ['slickBeforeChange']
        }], breakpoint: [{
            type: Output,
            args: ['slickBreakpoint']
        }], destroy: [{
            type: Output,
            args: ['slickDestroy']
        }], init: [{
            type: Output,
            args: ['slickInit']
        }] }); })();
if (false) {
    /** @type {?} */
    SlickContainerDirective.prototype.config;
    /** @type {?} */
    SlickContainerDirective.prototype.afterChange;
    /** @type {?} */
    SlickContainerDirective.prototype.beforeChange;
    /** @type {?} */
    SlickContainerDirective.prototype.breakpoint;
    /** @type {?} */
    SlickContainerDirective.prototype.destroy;
    /** @type {?} */
    SlickContainerDirective.prototype.init;
    /** @type {?} */
    SlickContainerDirective.prototype.slides;
    /** @type {?} */
    SlickContainerDirective.prototype.jQueryElement;
    /** @type {?} */
    SlickContainerDirective.prototype.initialize;
    /** @type {?} */
    SlickContainerDirective.prototype.slickCount;
    /**
     * @type {?}
     * @private
     */
    SlickContainerDirective.prototype.destroy$;
    /**
     * @type {?}
     * @private
     */
    SlickContainerDirective.prototype.elRef;
    /**
     * @type {?}
     * @private
     */
    SlickContainerDirective.prototype.zone;
    /**
     * @type {?}
     * @private
     */
    SlickContainerDirective.prototype.lazyLoadService;
    /**
     * @type {?}
     * @private
     */
    SlickContainerDirective.prototype.links;
}

//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2xpY2stY29udGFpbmVyLmRpcmVjdGl2ZS5qcyIsInNvdXJjZXMiOlsibmc6L25neC1zbGlja2pzL2xpYi9kaXJlY3RpdmVzL3NsaWNrLWNvbnRhaW5lci5kaXJlY3RpdmUudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7OztBQUFBLE9BQU8sRUFBRSxTQUFTLEVBQUUsVUFBVSxFQUFFLFlBQVksRUFBRSxLQUFLLEVBQUUsTUFBTSxFQUFhLE1BQU0sRUFBRSxNQUFNLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDOUcsT0FBTyxPQUFPLE1BQU0sY0FBYyxDQUFDO0FBQ25DLE9BQU8sRUFBRSxJQUFJLEVBQUUsR0FBRyxFQUFFLE1BQU0sRUFBRSxTQUFTLEVBQUUsU0FBUyxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFHekUsT0FBTyxFQUFFLEtBQUssRUFBRSxRQUFRLEVBQUUsU0FBUyxFQUFFLE9BQU8sRUFBRSxNQUFNLE1BQU0sQ0FBQztBQUMzRCxPQUFPLEVBQUUsZUFBZSxFQUFFLE1BQU0sK0JBQStCLENBQUM7O0FBUWhFLE1BQU0sT0FBTyx1QkFBdUI7QUFBRztBQUFRO0FBQ3BDO0FBQ0Q7QUFFRTtBQUNOO0FBQVEsSUF3QlosWUFDVSxLQUFpQixFQUNqQixJQUFZLEVBQ1osZUFBZ0MsRUFDVCxLQUFvQjtBQUNyRCxRQUpVLFVBQUssR0FBTCxLQUFLLENBQVk7QUFBQyxRQUNsQixTQUFJLEdBQUosSUFBSSxDQUFRO0FBQUMsUUFDYixvQkFBZSxHQUFmLGVBQWUsQ0FBaUI7QUFBQyxRQUNWLFVBQUssR0FBTCxLQUFLLENBQWU7QUFBQyxRQS9CdEQsV0FBTSxHQUFHLG1CQUFBLEVBQUUsRUFBZ0IsQ0FBQztBQUM5QixRQUVFLGdCQUFXLEdBQXNCLElBQUksWUFBWSxFQUFFLENBQUM7QUFDdEQsUUFFRSxpQkFBWSxHQUFzQixJQUFJLFlBQVksRUFBRSxDQUFDO0FBQ3ZELFFBRUUsZUFBVSxHQUFzQixJQUFJLFlBQVksRUFBRSxDQUFDO0FBQ3JELFFBRUUsWUFB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QWxCLHVDQUM2QztBQUMvQztBQUNvQixJQUFsQix5Q0FBMkI7QUFDN0I7QUFDb0IsSUFBbEIsZ0RBQW1CO0FBQ3JCO0FBQ29CLElBQWxCLDZDQUE0QjtBQUM5QjtBQUNvQixJQUFsQiw2Q0FBdUI7QUFDekI7QUFDTztBQUFpQjtBQUVyQjtBQUFRLElBRlQsMkNBQWlDO0FBQ25DO0FBQ087QUFDRTtBQUFnQjtBQUN2QixJQURFLHdDQUF5QjtBQUFDO0FBQ3ZCO0FBQWlCO0FBQ1Y7QUFBUSxJQURsQix1Q0FBb0I7QUFBQztBQUNsQjtBQUFpQjtBQUFnQjtBQUN0QyxJQURFLGtEQUF3QztBQUFDO0FBQ3RDO0FBQWlCO0FBQWdCO0FBQVEsSUFBNUMsd0NBQW1EO0FBQUM7QUFDdkQiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBEaXJlY3RpdmUsIEVsZW1lbnRSZWYsIEV2ZW50RW1pdHRlciwgSW5wdXQsIE5nWm9uZSwgT25EZXN0cm95LCBPdXRwdXQsIEluamVjdCB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IGNvbXBhcmUgZnJvbSAnanVzdC1jb21wYXJlJztcbmltcG9ydCB7IHRha2UsIG1hcCwgZmlsdGVyLCBzd2l0Y2hNYXAsIHRha2VVbnRpbCB9IGZyb20gJ3J4anMvb3BlcmF0b3JzJztcbmltcG9ydCB7IE9wdGlvbnMgfSBmcm9tICcuLi9tb2RlbHMvb3B0aW9ucyc7XG5pbXBvcnQgeyBTbGljayB9IGZyb20gJy4uL21vZGVscy9zbGljayc7XG5pbXBvcnQgeyB0aW1lciwgZm9ya0pvaW4sIGZyb21FdmVudCwgU3ViamVjdCB9IGZyb20gJ3J4anMnO1xuaW1wb3J0IHsgTGF6eUxvYWRTZXJ2aWNlIH0gZnJvbSAnLi4vc2VydmljZXMvbGF6eS1sb2FkLnNlcnZpY2UnO1xuXG5kZWNsYXJlIGNvbnN0ICQ6IGFueTtcblxuQERpcmVjdGl2ZSh7XG4gIHNlbGVjdG9yOiAnW3NsaWNrQ29udGFpbmVyXScsXG4gIGV4cG9ydEFzOiAnc2xpY2snLFxufSlcbmV4cG9ydCBjbGFzcyBTbGlja0NvbnRhaW5lckRpcmVjdGl2ZSBpbXBsZW1lbnRzIE9uRGVzdHJveSB7XG4gIEBJbnB1dCgnc2xpY2tDb25maWcnKVxuICBjb25maWcgPSB7fSBhcyBTbGljay5Db25maWc7XG5cbiAgQE91dHB1dCgnc2xpY2tBZnRlckNoYW5nZScpXG4gIGFmdGVyQ2hhbmdlOiBFdmVudEVtaXR0ZXI8YW55PiA9IG5ldyBFdmVudEVtaXR0ZXIoKTtcblxuICBAT3V0cHV0KCdzbGlja0JlZm9yZUNoYW5nZScpXG4gIGJlZm9yZUNoYW5nZTogRXZlbnRFbWl0dGVyPGFueT4gPSBuZXcgRXZlbnRFbWl0dGVyKCk7XG5cbiAgQE91dHB1dCgnc2xpY2tCcmVha3BvaW50JylcbiAgYnJlYWtwb2ludDogRXZlbnRFbWl0dGVyPGFueT4gPSBuZXcgRXZlbnRFbWl0dGVyKCk7XG5cbiAgQE91dHB1dCgnc2xpY2tEZXN0cm95JylcbiAgZGVzdHJveTogRXZlbnRFbWl0dGVyPGFueT4gPSBuZXcgRXZlbnRFbWl0dGVyKCk7XG5cbiAgQE91dHB1dCgnc2xpY2tJbml0JylcbiAgaW5pdDogRXZlbnRFbWl0dGVyPGFueT4gPSBuZXcgRXZlbnRFbWl0dGVyKCk7XG5cbiAgc2xpZGVzOiBIVE1MRWxlbWVudFtdID0gW107XG5cbiAgalF1ZXJ5RWxlbWVudDogYW55O1xuXG4gIGluaXRpYWxpemU6IGJvb2xlYW4gPSBmYWxzZTtcblxuICBzbGlja0NvdW50OiBudW1iZXIgPSAwO1xuXG4gIHByaXZhdGUgZGVzdHJveSQgPSBuZXcgU3ViamVjdCgpO1xuXG4gIGNvbnN0cnVjdG9yKFxuICAgIHByaXZhdGUgZWxSZWY6IEVsZW1lbnRSZWYsXG4gICAgcHJpdmF0ZSB6b25lOiBOZ1pvbmUsXG4gICAgcHJpdmF0ZSBsYXp5TG9hZFNlcnZpY2U6IExhenlMb2FkU2VydmljZSxcbiAgICBASW5qZWN0KCdzbGljay1saW5rcycpIHByaXZhdGUgbGlua3M6IE9wdGlvbnMuTGlua3MsXG4gICkge31cblxuICBuZ0FmdGVyVmlld0luaXQoKSB7XG4gICAgdGhpcy5sYXp5TG9hZFNlcnZpY2VcbiAgICAgIC5sb2FkKHRoaXMubGlua3MuanF1ZXJ5LCAnc2NyaXB0JylcbiAgICAgIC5waXBlKFxuICAgICAgICBtYXAoKCkgPT4gJ2pRdWVyeSBpcyBsb2FkZWQnKSxcbiAgICAgICAgZmlsdGVyKGpxdWVyeSA9PiAhIWpxdWVyeSksXG4gICAgICAgIHN3aXRjaE1hcCgoKSA9PlxuICAgICAgICAgIGZvcmtKb2luKFxuICAgICAgICAgICAgdGhpcy5sYXp5TG9hZFNlcnZpY2UubG9hZCh0aGlzLmxpbmtzLnNsaWNrSnMsICdzY3JpcHQnKSxcbiAgICAgICAgICAgIHRoaXMubGF6eUxvYWRTZXJ2aWNlLmxvYWQodGhpcy5saW5rcy5zbGlja0NzcywgJ3N0eWxlJyksXG4gICAgICAgICAgICB0aGlzLmxhenlMb2FkU2VydmljZS5sb2FkKHRoaXMubGlua3Muc2xpY2tUaGVtZUNzcywgJ3N0eWxlJyksXG4gICAgICAgICAgKSxcbiAgICAgICAgKSxcbiAgICAgICAgdGFrZSgxKSxcbiAgICAgIClcbiAgICAgIC5zdWJzY3JpYmUoKCkgPT4ge1xuICAgICAgICB0aGlzLmluaXRTbGljaygpO1xuICAgICAgfSk7XG4gIH1cblxuICBuZ09uRGVzdHJveSgpIHtcbiAgICB0aGlzLnVuc2xpY2soKTtcbiAgICB0aGlzLnNsaWRlcyA9IFtdO1xuICAgIHRoaXMuZGVzdHJveSQubmV4dCgpO1xuICB9XG5cbiAgaW5pdFNsaWNrKCkge1xuICAgIGNvbnN0IHRoYXQgPSB0aGlzO1xuICAgIHRoaXMuem9uZS5ydW5PdXRzaWRlQW5ndWxhcigoKSA9PiB7XG4gICAgICAkKHRoaXMuZWxSZWYubmF0aXZlRWxlbWVudClbMF0uaW5uZXJIVE1MID0gJyc7XG4gICAgICB0aGlzLmpRdWVyeUVsZW1lbnQgPSAkKHRoaXMuZWxSZWYubmF0aXZlRWxlbWVudCk7XG4gICAgICB0aGlzLmpRdWVyeUVsZW1lbnQub24oJ2luaXQnLCAoZXZlbnQsIHNsaWNrKSA9PiB7XG4gICAgICAgIHRoaXMuem9uZS5ydW4oKCkgPT4ge1xuICAgICAgICAgIHRpbWVyKDApLnN1YnNjcmliZSgoKSA9PiB7XG4gICAgICAgICAgICB0aGlzLmluaXQuZW1pdCh7IGV2ZW50LCBzbGljayB9KTtcblxuICAgICAgICAgICAgaWYgKHRoaXMuY29uZmlnICYmIHRoaXMuY29uZmlnLmluaXRpYWxTbGlkZSAmJiB0aGlzLmNvbmZpZy5pbml0aWFsU2xpZGUgPD0gdGhpcy5zbGlkZXMubGVuZ3RoKSB7XG4gICAgICAgICAgICAgIHRoaXMuZ29Ubyh0aGlzLmNvbmZpZy5pbml0aWFsU2xpZGUpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICAgIH0pO1xuXG4gICAgICB0aGlzLmpRdWVyeUVsZW1lbnQuc2xpY2sodGhpcy5jb25maWcpO1xuICAgICAgdGhpcy5pbml0aWFsaXplID0gdHJ1ZTtcbiAgICAgIHRoaXMubGlzdGVuTW91c2VXaGVlbCgpO1xuXG4gICAgICB0aGlzLmpRdWVyeUVsZW1lbnQub24oJ2FmdGVyQ2hhbmdlJywgKGV2ZW50LCBzbGljaywgY3VycmVudFNsaWRlKSA9PiB7XG4gICAgICAgIHRoYXQuem9uZS5ydW4oKCkgPT4ge1xuICAgICAgICAgIHRoYXQuYWZ0ZXJDaGFuZ2UuZW1pdCh7IGV2ZW50LCBzbGljaywgY3VycmVudFNsaWRlIH0pO1xuICAgICAgICB9KTtcbiAgICAgIH0pO1xuXG4gICAgICB0aGlzLmpRdWVyeUVsZW1lbnQub24oJ2JlZm9yZUNoYW5nZScsIChldmVudCwgc2xpY2ssIGN1cnJlbnRTbGlkZSwgbmV4dFNsaWRlKSA9PiB7XG4gICAgICAgIHRoYXQuem9uZS5ydW4oKCkgPT4ge1xuICAgICAgICAgIHRoaXMuc2xpY2tDb3VudCA9IHNsaWNrLnNsaWRlQ291bnQ7XG4gICAgICAgICAgdGhhdC5iZWZvcmVDaGFuZ2UuZW1pdCh7IGV2ZW50LCBzbGljaywgY3VycmVudFNsaWRlLCBuZXh0U2xpZGUgfSk7XG4gICAgICAgIH0pO1xuICAgICAgfSk7XG5cbiAgICAgIHRoaXMualF1ZXJ5RWxlbWVudC5vbignYnJlYWtwb2ludCcsIChldmVudCwgc2xpY2ssIGJyZWFrcG9pbnQpID0+IHtcbiAgICAgICAgdGhhdC56b25lLnJ1bigoKSA9PiB7XG4gICAgICAgICAgdGhhdC5icmVha3BvaW50LmVtaXQoeyBldmVudCwgc2xpY2ssIGJyZWFrcG9pbnQgfSk7XG4gICAgICAgIH0pO1xuICAgICAgfSk7XG5cbiAgICAgIHRoaXMualF1ZXJ5RWxlbWVudC5vbignZGVzdHJveScsIChldmVudCwgc2xpY2spID0+IHtcbiAgICAgICAgdGhhdC56b25lLnJ1bigoKSA9PiB7XG4gICAgICAgICAgdGhhdC5kZXN0cm95LmVtaXQoeyBldmVudCwgc2xpY2sgfSk7XG4gICAgICAgIH0pO1xuICAgICAgfSk7XG4gICAgfSk7XG5cbiAgICB0aGlzLnN5bmNTbGlkZXMoKTtcbiAgfVxuXG4gIHN5bmNTbGlkZXMoKSB7XG4gICAgaWYgKHRoaXMuc2xpY2tDb3VudCA+PSB0aGlzLnNsaWRlcy5sZW5ndGgpIHJldHVybjtcblxuICAgIHRoaXMuc2xpZGVzLmZvckVhY2goc2xpZGUgPT4ge1xuICAgICAgdGhpcy56b25lLnJ1bigoKSA9PiB7XG4gICAgICAgIHRoaXMualF1ZXJ5RWxlbWVudC5zbGljaygnc2xpY2tBZGQnLCBzbGlkZSk7XG4gICAgICB9KTtcbiAgICB9KTtcbiAgfVxuXG4gIGFkZFNsaWRlKHNsaWRlOiBIVE1MRWxlbWVudCkge1xuICAgIHRoaXMuc2xpZGVzID0gWy4uLnRoaXMuc2xpZGVzLCBzbGlkZV07XG5cbiAgICBpZiAoIXRoaXMuaW5pdGlhbGl6ZSkgcmV0dXJuO1xuXG4gICAgdGhpcy56b25lLnJ1bigoKSA9PiB7XG4gICAgICB0aGlzLmpRdWVyeUVsZW1lbnQuc2xpY2soJ3NsaWNrQWRkJywgc2xpZGUpO1xuICAgIH0pO1xuICB9XG5cbiAgcmVtb3ZlU2xpZGUoc2xpZGU6IEhUTUxFbGVtZW50KSB7XG4gICAgdGhpcy5zbGlkZXMgPSB0aGlzLnNsaWRlcy5maWx0ZXIoc2xpZGUgPT4gY29tcGFyZShzbGlkZSwgc2xpZGUpKTtcblxuICAgIGlmICghdGhpcy5pbml0aWFsaXplKSByZXR1cm47XG5cbiAgICB0aGlzLnpvbmUucnVuKCgpID0+IHtcbiAgICAgIHRoaXMualF1ZXJ5RWxlbWVudC5zbGljaygnc2xpY2tSZW1vdmUnLCB0aGlzLnNsaWRlcy5pbmRleE9mKHNsaWRlKSk7XG4gICAgfSk7XG4gIH1cblxuICBnb1RvKGluZGV4OiBudW1iZXIpIHtcbiAgICB0aGlzLnpvbmUucnVuKCgpID0+IHtcbiAgICAgIHRoaXMualF1ZXJ5RWxlbWVudC5zbGljaygnc2xpY2tHb1RvJywgaW5kZXgpO1xuICAgIH0pO1xuICB9XG5cbiAgbmV4dCgpIHtcbiAgICB0aGlzLnpvbmUucnVuKCgpID0+IHtcbiAgICAgIHRoaXMualF1ZXJ5RWxlbWVudC5zbGljaygnc2xpY2tOZXh0Jyk7XG4gICAgfSk7XG4gIH1cblxuICBwcmV2KCkge1xuICAgIHRoaXMuem9uZS5ydW4oKCkgPT4ge1xuICAgICAgdGhpcy5qUXVlcnlFbGVtZW50LnNsaWNrKCdzbGlja1ByZXYnKTtcbiAgICB9KTtcbiAgfVxuXG4gIHBhdXNlKCkge1xuICAgIHRoaXMuem9uZS5ydW4oKCkgPT4ge1xuICAgICAgdGhpcy5qUXVlcnlFbGVtZW50LnNsaWNrKCdzbGlja1BhdXNlJyk7XG4gICAgfSk7XG4gIH1cblxuICBwbGF5KCkge1xuICAgIHRoaXMuem9uZS5ydW4oKCkgPT4ge1xuICAgICAgdGhpcy5qUXVlcnlFbGVtZW50LnNsaWNrKCdzbGlja1BsYXknKTtcbiAgICB9KTtcbiAgfVxuXG4gIHVuc2xpY2soKSB7XG4gICAgaWYgKHRoaXMualF1ZXJ5RWxlbWVudCkge1xuICAgICAgdGhpcy56b25lLnJ1bigoKSA9PiB7XG4gICAgICAgIHRoaXMualF1ZXJ5RWxlbWVudC5zbGljaygndW5zbGljaycpO1xuICAgICAgfSk7XG4gICAgfVxuICAgIHRoaXMuaW5pdGlhbGl6ZSA9IGZhbHNlO1xuICB9XG5cbiAgbGlzdGVuTW91c2VXaGVlbCgpIHtcbiAgICBpZiAodGhpcy5jb25maWcubW91c2VXaGVlbE1vdmUgPT09IGZhbHNlKSByZXR1cm47XG5cbiAgICBmcm9tRXZlbnQodGhpcy5lbFJlZi5uYXRpdmVFbGVtZW50LCAnd2hlZWwnKVxuICAgICAgLnBpcGUodGFrZVVudGlsKHRoaXMuZGVzdHJveSQpKVxuICAgICAgLnN1YnNjcmliZSgoZXZlbnQ6IE1vdXNlV2hlZWxFdmVudCkgPT4ge1xuICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICBpZiAoZXZlbnQuZGVsdGFYID4gMCB8fCBldmVudC5kZWx0YVkgPCAwKSB7XG4gICAgICAgICAgdGhpcy5wcmV2KCk7XG4gICAgICAgIH0gZWxzZSBpZiAoZXZlbnQuZGVsdGFYIDwgMCB8fCBldmVudC5kZWx0YVkgPiAwKSB7XG4gICAgICAgICAgdGhpcy5uZXh0KCk7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICB9XG59XG4iXX0=